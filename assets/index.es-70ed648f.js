import{t as mt,e as bt}from"./tslib-81c86893.js";import{c as Yt,g as Ua,r as La}from"./index-7598ca01.js";import{s as Ri,a as Un,b as Ln,d as Mn,i as fs,c as Ma,e as $a,f as $n,g as Ui,p as ja,J as Li,h as Mi,j as $i,k as Lt,l as At,m as jn,n as ji,H as zn}from"./http-e5dfaf55.js";function za(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Ba=Ha;function Ha(t,e,r){var i=r&&r.stringify||za,s=1;if(typeof t=="object"&&t!==null){var c=e.length+s;if(c===1)return t;var u=new Array(c);u[0]=i(t);for(var a=1;a<c;a++)u[a]=i(e[a]);return u.join(" ")}if(typeof t!="string")return t;var h=e.length;if(h===0)return t;for(var w="",_=1-s,E=-1,C=t&&t.length||0,v=0;v<C;){if(t.charCodeAt(v)===37&&v+1<C){switch(E=E>-1?E:0,t.charCodeAt(v+1)){case 100:case 102:if(_>=h||e[_]==null)break;E<v&&(w+=t.slice(E,v)),w+=Number(e[_]),E=v+2,v++;break;case 105:if(_>=h||e[_]==null)break;E<v&&(w+=t.slice(E,v)),w+=Math.floor(Number(e[_])),E=v+2,v++;break;case 79:case 111:case 106:if(_>=h||e[_]===void 0)break;E<v&&(w+=t.slice(E,v));var D=typeof e[_];if(D==="string"){w+="'"+e[_]+"'",E=v+2,v++;break}if(D==="function"){w+=e[_].name||"<anonymous>",E=v+2,v++;break}w+=i(e[_]),E=v+2,v++;break;case 115:if(_>=h)break;E<v&&(w+=t.slice(E,v)),w+=String(e[_]),E=v+2,v++;break;case 37:E<v&&(w+=t.slice(E,v)),w+="%",E=v+2,v++,_--;break}++_}++v}return E===-1?t:(E<C&&(w+=t.slice(E)),w)}const ds=Ba;var Dr=xt;const mr=Za().console||{},qa={mapHttpRequest:$r,mapHttpResponse:$r,wrapRequestSerializer:ni,wrapResponseSerializer:ni,wrapErrorSerializer:ni,req:$r,res:$r,err:Wa};function Ka(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function xt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||mr;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},s=Ka(t.browser.serialize,i);let c=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const u=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",h=Object.create(r);h.log||(h.log=Er),Object.defineProperty(h,"levelVal",{get:_}),Object.defineProperty(h,"level",{get:E,set:C});const w={transmit:e,serialize:s,asObject:t.browser.asObject,levels:u,timestamp:Ya(t)};h.levels=xt.levels,h.level=a,h.setMaxListeners=h.getMaxListeners=h.emit=h.addListener=h.on=h.prependListener=h.once=h.prependOnceListener=h.removeListener=h.removeAllListeners=h.listeners=h.listenerCount=h.eventNames=h.write=h.flush=Er,h.serializers=i,h._serialize=s,h._stdErrSerialize=c,h.child=v,e&&(h._logEvent=wi());function _(){return this.level==="silent"?1/0:this.levels.values[this.level]}function E(){return this._level}function C(D){if(D!=="silent"&&!this.levels.values[D])throw Error("unknown level "+D);this._level=D,tr(w,h,"error","log"),tr(w,h,"fatal","error"),tr(w,h,"warn","error"),tr(w,h,"info","log"),tr(w,h,"debug","log"),tr(w,h,"trace","log")}function v(D,P){if(!D)throw new Error("missing bindings for child Pino");P=P||{},s&&D.serializers&&(P.serializers=D.serializers);const T=P.serializers;if(s&&T){var L=Object.assign({},i,T),l=t.browser.serialize===!0?Object.keys(L):s;delete D.serializers,Wr([D],l,L,this._stdErrSerialize)}function b(f){this._childLevel=(f._childLevel|0)+1,this.error=rr(f,D,"error"),this.fatal=rr(f,D,"fatal"),this.warn=rr(f,D,"warn"),this.info=rr(f,D,"info"),this.debug=rr(f,D,"debug"),this.trace=rr(f,D,"trace"),L&&(this.serializers=L,this._serialize=l),e&&(this._logEvent=wi([].concat(f._logEvent.bindings,D)))}return b.prototype=this,new b(this)}return h}xt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};xt.stdSerializers=qa;xt.stdTimeFunctions=Object.assign({},{nullTime:Bn,epochTime:Hn,unixTime:Ja,isoTime:Xa});function tr(t,e,r,i){const s=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Er:s[r]?s[r]:mr[r]||mr[i]||Er,Va(t,e,r)}function Va(t,e,r){!t.transmit&&e[r]===Er||(e[r]=function(i){return function(){const c=t.timestamp(),u=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===mr?mr:this;for(var h=0;h<u.length;h++)u[h]=arguments[h];if(t.serialize&&!t.asObject&&Wr(u,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(a,Ga(this,r,u,c)):i.apply(a,u),t.transmit){const w=t.transmit.level||e.level,_=xt.levels.values[w],E=xt.levels.values[r];if(E<_)return;ka(this,{ts:c,methodLevel:r,methodValue:E,transmitLevel:w,transmitValue:xt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},u)}}}(e[r]))}function Ga(t,e,r,i){t._serialize&&Wr(r,t._serialize,t.serializers,t._stdErrSerialize);const s=r.slice();let c=s[0];const u={};i&&(u.time=i),u.level=xt.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),c!==null&&typeof c=="object"){for(;a--&&typeof s[0]=="object";)Object.assign(u,s.shift());c=s.length?ds(s.shift(),s):void 0}else typeof c=="string"&&(c=ds(s.shift(),s));return c!==void 0&&(u.msg=c),u}function Wr(t,e,r,i){for(const s in t)if(i&&t[s]instanceof Error)t[s]=xt.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s]))for(const c in t[s])e&&e.indexOf(c)>-1&&c in r&&(t[s][c]=r[c](t[s][c]))}function rr(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return t[r].apply(this,i)}}function ka(t,e,r){const i=e.send,s=e.ts,c=e.methodLevel,u=e.methodValue,a=e.val,h=t._logEvent.bindings;Wr(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(w){return h.indexOf(w)===-1}),t._logEvent.level.label=c,t._logEvent.level.value=u,i(c,t._logEvent,a),t._logEvent=wi(h)}function wi(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function Wa(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function Ya(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Bn:Hn}function $r(){return{}}function ni(t){return t}function Er(){}function Bn(){return!1}function Hn(){return Date.now()}function Ja(){return Math.round(Date.now()/1e3)}function Xa(){return new Date(Date.now()).toISOString()}function Za(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}var Yr={},Sr={};Object.defineProperty(Sr,"__esModule",{value:!0});function Qa(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}Sr.safeJsonParse=Qa;function ec(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}Sr.safeJsonStringify=ec;var Hr={},oi={get exports(){return Hr},set exports(t){Hr=t}},gs;function tc(){return gs||(gs=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Yt<"u"&&Yt.localStorage?oi.exports=Yt.localStorage:typeof window<"u"&&window.localStorage?oi.exports=window.localStorage:oi.exports=new e}()),Hr}var ai={},lr={},ps;function rc(){if(ps)return lr;ps=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.IKeyValueStorage=void 0;class t{}return lr.IKeyValueStorage=t,lr}var fr={},ys;function ic(){if(ys)return fr;ys=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.parseEntry=void 0;const t=Sr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return fr.parseEntry=e,fr}var bs;function sc(){return bs||(bs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(rc(),t),e.__exportStar(ic(),t)}(ai)),ai}Object.defineProperty(Yr,"__esModule",{value:!0});Yr.KeyValueStorage=void 0;const sr=mt,_s=Sr,nc=sr.__importDefault(tc()),oc=sc();class qn{constructor(){this.localStorage=nc.default}getKeys(){return sr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return sr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(oc.parseEntry)})}getItem(e){return sr.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return _s.safeJsonParse(r)})}setItem(e,r){return sr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,_s.safeJsonStringify(r))})}removeItem(e){return sr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Yr.KeyValueStorage=qn;var ac=Yr.default=qn,xr={},dr={},Q={},ci={},gr={},ws;function cc(){if(ws)return gr;ws=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return gr.delay=t,gr}var Kt={},hi={},Vt={},ms;function hc(){return ms||(ms=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.ONE_THOUSAND=Vt.ONE_HUNDRED=void 0,Vt.ONE_HUNDRED=100,Vt.ONE_THOUSAND=1e3),Vt}var ui={},Es;function uc(){return Es||(Es=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(ui)),ui}var vs;function Kn(){return vs||(vs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(hc(),t),e.__exportStar(uc(),t)}(hi)),hi}var Ds;function lc(){if(Ds)return Kt;Ds=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.fromMiliseconds=Kt.toMiliseconds=void 0;const t=Kn();function e(i){return i*t.ONE_THOUSAND}Kt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Kt.fromMiliseconds=r,Kt}var Ss;function fc(){return Ss||(Ss=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(cc(),t),e.__exportStar(lc(),t)}(ci)),ci}var ir={},xs;function dc(){if(xs)return ir;xs=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return ir.Watch=t,ir.default=t,ir}var li={},pr={},Is;function gc(){if(Is)return pr;Is=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.IWatch=void 0;class t{}return pr.IWatch=t,pr}var Os;function pc(){return Os||(Os=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),mt.__exportStar(gc(),t)}(li)),li}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(fc(),t),e.__exportStar(dc(),t),e.__exportStar(pc(),t),e.__exportStar(Kn(),t)})(Q);var fi={},yr={};class Jt{}const yc=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Jt},Symbol.toStringTag,{value:"Module"})),bc=Ua(yc);var Ts;function _c(){if(Ts)return yr;Ts=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.IHeartBeat=void 0;const t=bc;class e extends t.IEvents{constructor(i){super()}}return yr.IHeartBeat=e,yr}var As;function Vn(){return As||(As=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),mt.__exportStar(_c(),t)}(fi)),fi}var di={},Gt={},Ns;function wc(){if(Ns)return Gt;Ns=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.HEARTBEAT_EVENTS=Gt.HEARTBEAT_INTERVAL=void 0;const t=Q;return Gt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Gt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Gt}var Cs;function Gn(){return Cs||(Cs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),mt.__exportStar(wc(),t)}(di)),di}var Ps;function mc(){if(Ps)return dr;Ps=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.HeartBeat=void 0;const t=mt,e=bt,r=Q,i=Vn(),s=Gn();class c extends i.IHeartBeat{constructor(a){super(a),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(a==null?void 0:a.interval)||s.HEARTBEAT_INTERVAL}static init(a){return t.__awaiter(this,void 0,void 0,function*(){const h=new c(a);return yield h.init(),h})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}on(a,h){this.events.on(a,h)}once(a,h){this.events.once(a,h)}off(a,h){this.events.off(a,h)}removeListener(a,h){this.events.removeListener(a,h)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return dr.HeartBeat=c,dr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(mc(),t),e.__exportStar(Vn(),t),e.__exportStar(Gn(),t)})(xr);var Se={},kt={},Fs;function kn(){return Fs||(Fs=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.PINO_CUSTOM_CONTEXT_KEY=kt.PINO_LOGGER_DEFAULTS=void 0,kt.PINO_LOGGER_DEFAULTS={level:"info"},kt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),kt}var it={},Rs;function Ec(){if(Rs)return it;Rs=1,Object.defineProperty(it,"__esModule",{value:!0}),it.generateChildLogger=it.formatChildLoggerContext=it.getLoggerContext=it.setBrowserLoggerContext=it.getBrowserLoggerContext=it.getDefaultLoggerOptions=void 0;const t=kn();function e(a){return Object.assign(Object.assign({},a),{level:(a==null?void 0:a.level)||t.PINO_LOGGER_DEFAULTS.level})}it.getDefaultLoggerOptions=e;function r(a,h=t.PINO_CUSTOM_CONTEXT_KEY){return a[h]||""}it.getBrowserLoggerContext=r;function i(a,h,w=t.PINO_CUSTOM_CONTEXT_KEY){return a[w]=h,a}it.setBrowserLoggerContext=i;function s(a,h=t.PINO_CUSTOM_CONTEXT_KEY){let w="";return typeof a.bindings>"u"?w=r(a,h):w=a.bindings().context||"",w}it.getLoggerContext=s;function c(a,h,w=t.PINO_CUSTOM_CONTEXT_KEY){const _=s(a,w);return _.trim()?`${_}/${h}`:h}it.formatChildLoggerContext=c;function u(a,h,w=t.PINO_CUSTOM_CONTEXT_KEY){const _=c(a,h,w),E=a.child({context:_});return i(E,_,w)}return it.generateChildLogger=u,it}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=mt,r=e.__importDefault(Dr);Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(kn(),t),e.__exportStar(Ec(),t)})(Se);class vc extends Jt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let Dc=class extends Jt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}},Sc=class{constructor(e,r){this.logger=e,this.core=r}},xc=class extends Jt{constructor(e,r){super(),this.relayer=e,this.logger=r}};class Ic extends Jt{constructor(e){super()}}let Oc=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}};class Tc extends Jt{constructor(e,r){super(),this.relayer=e,this.logger=r}}let Ac=class extends Jt{constructor(e,r){super(),this.core=e,this.logger=r}},Nc=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},Cc=class{constructor(e){this.client=e}};var zi={},nr={},Jr={},Xr={};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.BrowserRandomSource=void 0;const Us=65536;class Pc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Us)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Us)));return r}}Xr.BrowserRandomSource=Pc;function Fc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Zr={},ft={};Object.defineProperty(ft,"__esModule",{value:!0});function Rc(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ft.wipe=Rc;Object.defineProperty(Zr,"__esModule",{value:!0});Zr.NodeRandomSource=void 0;const Uc=ft;class Lc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Fc<"u"){const e=La;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=r[s];return(0,Uc.wipe)(r),i}}Zr.NodeRandomSource=Lc;Object.defineProperty(Jr,"__esModule",{value:!0});Jr.SystemRandomSource=void 0;const Mc=Xr,$c=Zr;class jc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Mc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new $c.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Jr.SystemRandomSource=jc;var re={},Wn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(a,h){var w=a>>>16&65535,_=a&65535,E=h>>>16&65535,C=h&65535;return _*C+(w*C+_*E<<16>>>0)|0}t.mul=Math.imul||e;function r(a,h){return a+h|0}t.add=r;function i(a,h){return a-h|0}t.sub=i;function s(a,h){return a<<h|a>>>32-h}t.rotl=s;function c(a,h){return a<<32-h|a>>>h}t.rotr=c;function u(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a}t.isInteger=Number.isInteger||u,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(a){return t.isInteger(a)&&a>=-t.MAX_SAFE_INTEGER&&a<=t.MAX_SAFE_INTEGER}})(Wn);Object.defineProperty(re,"__esModule",{value:!0});var Yn=Wn;function zc(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}re.readInt16BE=zc;function Bc(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}re.readUint16BE=Bc;function Hc(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}re.readInt16LE=Hc;function qc(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}re.readUint16LE=qc;function Jn(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}re.writeUint16BE=Jn;re.writeInt16BE=Jn;function Xn(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}re.writeUint16LE=Xn;re.writeInt16LE=Xn;function mi(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}re.readInt32BE=mi;function Ei(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}re.readUint32BE=Ei;function vi(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}re.readInt32LE=vi;function Di(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}re.readUint32LE=Di;function qr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}re.writeUint32BE=qr;re.writeInt32BE=qr;function Kr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}re.writeUint32LE=Kr;re.writeInt32LE=Kr;function Kc(t,e){e===void 0&&(e=0);var r=mi(t,e),i=mi(t,e+4);return r*4294967296+i-(i>>31)*4294967296}re.readInt64BE=Kc;function Vc(t,e){e===void 0&&(e=0);var r=Ei(t,e),i=Ei(t,e+4);return r*4294967296+i}re.readUint64BE=Vc;function Gc(t,e){e===void 0&&(e=0);var r=vi(t,e),i=vi(t,e+4);return i*4294967296+r-(r>>31)*4294967296}re.readInt64LE=Gc;function kc(t,e){e===void 0&&(e=0);var r=Di(t,e),i=Di(t,e+4);return i*4294967296+r}re.readUint64LE=kc;function Zn(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),qr(t/4294967296>>>0,e,r),qr(t>>>0,e,r+4),e}re.writeUint64BE=Zn;re.writeInt64BE=Zn;function Qn(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Kr(t>>>0,e,r),Kr(t/4294967296>>>0,e,r+4),e}re.writeUint64LE=Qn;re.writeInt64LE=Qn;function Wc(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,c=t/8+r-1;c>=r;c--)i+=e[c]*s,s*=256;return i}re.readUintBE=Wc;function Yc(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,c=r;c<r+t/8;c++)i+=e[c]*s,s*=256;return i}re.readUintLE=Yc;function Jc(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Yn.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,c=t/8+i-1;c>=i;c--)r[c]=e/s&255,s*=256;return r}re.writeUintBE=Jc;function Xc(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Yn.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,c=i;c<i+t/8;c++)r[c]=e/s&255,s*=256;return r}re.writeUintLE=Xc;function Zc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}re.readFloat32BE=Zc;function Qc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}re.readFloat32LE=Qc;function eh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}re.readFloat64BE=eh;function th(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}re.readFloat64LE=th;function rh(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}re.writeFloat32BE=rh;function ih(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}re.writeFloat32LE=ih;function sh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}re.writeFloat64BE=sh;function nh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}re.writeFloat64LE=nh;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Jr,r=re,i=ft;t.defaultRandomSource=new e.SystemRandomSource;function s(w,_=t.defaultRandomSource){return _.randomBytes(w)}t.randomBytes=s;function c(w=t.defaultRandomSource){const _=s(4,w),E=(0,r.readUint32LE)(_);return(0,i.wipe)(_),E}t.randomUint32=c;const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function a(w,_=u,E=t.defaultRandomSource){if(_.length<2)throw new Error("randomString charset is too short");if(_.length>256)throw new Error("randomString charset is too long");let C="";const v=_.length,D=256-256%v;for(;w>0;){const P=s(Math.ceil(w*256/D),E);for(let T=0;T<P.length&&w>0;T++){const L=P[T];L<D&&(C+=_.charAt(L%v),w--)}(0,i.wipe)(P)}return C}t.randomString=a;function h(w,_=u,E=t.defaultRandomSource){const C=Math.ceil(w/(Math.log(_.length)/Math.LN2));return a(C,_,E)}t.randomStringForEntropy=h})(nr);var eo={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ft;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function a(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return a.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},a.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},a.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},a.prototype.update=function(h,w){if(w===void 0&&(w=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var _=0;if(this._bytesHashed+=w,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&w>0;)this._buffer[this._bufferLength++]=h[_++],w--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(w>=this.blockSize&&(_=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,_,w),w%=this.blockSize);w>0;)this._buffer[this._bufferLength++]=h[_++],w--;return this},a.prototype.finish=function(h){if(!this._finished){var w=this._bytesHashed,_=this._bufferLength,E=w/536870912|0,C=w<<3,v=w%128<112?128:256;this._buffer[_]=128;for(var D=_+1;D<v-8;D++)this._buffer[D]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(C,this._buffer,v-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var D=0;D<this.digestLength/8;D++)e.writeUint32BE(this._stateHi[D],h,D*8),e.writeUint32BE(this._stateLo[D],h,D*8+4);return this},a.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},a.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},a.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},a.prototype.cleanSavedState=function(h){r.wipe(h.stateHi),r.wipe(h.stateLo),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},a}();t.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(a,h,w,_,E,C,v){for(var D=w[0],P=w[1],T=w[2],L=w[3],l=w[4],b=w[5],f=w[6],g=w[7],p=_[0],n=_[1],d=_[2],F=_[3],j=_[4],Y=_[5],J=_[6],X=_[7],N,A,k,z,U,M,$,B;v>=128;){for(var ie=0;ie<16;ie++){var H=8*ie+C;a[ie]=e.readUint32BE(E,H),h[ie]=e.readUint32BE(E,H+4)}for(var ie=0;ie<80;ie++){var Z=D,W=P,ae=T,O=L,I=l,S=b,o=f,m=g,q=p,V=n,le=d,be=F,de=j,me=Y,Re=J,Ne=X;if(N=g,A=X,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=(l>>>14|j<<32-14)^(l>>>18|j<<32-18)^(j>>>41-32|l<<32-(41-32)),A=(j>>>14|l<<32-14)^(j>>>18|l<<32-18)^(l>>>41-32|j<<32-(41-32)),U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,N=l&b^~l&f,A=j&Y^~j&J,U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,N=s[ie*2],A=s[ie*2+1],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,N=a[ie%16],A=h[ie%16],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,k=$&65535|B<<16,z=U&65535|M<<16,N=k,A=z,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=(D>>>28|p<<32-28)^(p>>>34-32|D<<32-(34-32))^(p>>>39-32|D<<32-(39-32)),A=(p>>>28|D<<32-28)^(D>>>34-32|p<<32-(34-32))^(D>>>39-32|p<<32-(39-32)),U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,N=D&P^D&T^P&T,A=p&n^p&d^n&d,U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,m=$&65535|B<<16,Ne=U&65535|M<<16,N=O,A=be,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=k,A=z,U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,O=$&65535|B<<16,be=U&65535|M<<16,P=Z,T=W,L=ae,l=O,b=I,f=S,g=o,D=m,n=q,d=V,F=le,j=be,Y=de,J=me,X=Re,p=Ne,ie%16===15)for(var H=0;H<16;H++)N=a[H],A=h[H],U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=a[(H+9)%16],A=h[(H+9)%16],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,k=a[(H+1)%16],z=h[(H+1)%16],N=(k>>>1|z<<32-1)^(k>>>8|z<<32-8)^k>>>7,A=(z>>>1|k<<32-1)^(z>>>8|k<<32-8)^(z>>>7|k<<32-7),U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,k=a[(H+14)%16],z=h[(H+14)%16],N=(k>>>19|z<<32-19)^(z>>>61-32|k<<32-(61-32))^k>>>6,A=(z>>>19|k<<32-19)^(k>>>61-32|z<<32-(61-32))^(z>>>6|k<<32-6),U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,a[H]=$&65535|B<<16,h[H]=U&65535|M<<16}N=D,A=p,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=w[0],A=_[0],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,w[0]=D=$&65535|B<<16,_[0]=p=U&65535|M<<16,N=P,A=n,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=w[1],A=_[1],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,w[1]=P=$&65535|B<<16,_[1]=n=U&65535|M<<16,N=T,A=d,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=w[2],A=_[2],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,w[2]=T=$&65535|B<<16,_[2]=d=U&65535|M<<16,N=L,A=F,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=w[3],A=_[3],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,w[3]=L=$&65535|B<<16,_[3]=F=U&65535|M<<16,N=l,A=j,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=w[4],A=_[4],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,w[4]=l=$&65535|B<<16,_[4]=j=U&65535|M<<16,N=b,A=Y,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=w[5],A=_[5],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,w[5]=b=$&65535|B<<16,_[5]=Y=U&65535|M<<16,N=f,A=J,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=w[6],A=_[6],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,w[6]=f=$&65535|B<<16,_[6]=J=U&65535|M<<16,N=g,A=X,U=A&65535,M=A>>>16,$=N&65535,B=N>>>16,N=w[7],A=_[7],U+=A&65535,M+=A>>>16,$+=N&65535,B+=N>>>16,M+=U>>>16,$+=M>>>16,B+=$>>>16,w[7]=g=$&65535|B<<16,_[7]=X=U&65535|M<<16,C+=128,v-=128}return C}function u(a){var h=new i;h.update(a);var w=h.digest();return h.clean(),w}t.hash=u})(eo);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=nr,r=eo,i=ft;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function s(O){const I=new Float64Array(16);if(O)for(let S=0;S<O.length;S++)I[S]=O[S];return I}const c=new Uint8Array(32);c[0]=9;const u=s(),a=s([1]),h=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),w=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),_=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),E=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),C=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(O,I){for(let S=0;S<16;S++)O[S]=I[S]|0}function D(O){let I=1;for(let S=0;S<16;S++){let o=O[S]+I+65535;I=Math.floor(o/65536),O[S]=o-I*65536}O[0]+=I-1+37*(I-1)}function P(O,I,S){const o=~(S-1);for(let m=0;m<16;m++){const q=o&(O[m]^I[m]);O[m]^=q,I[m]^=q}}function T(O,I){const S=s(),o=s();for(let m=0;m<16;m++)o[m]=I[m];D(o),D(o),D(o);for(let m=0;m<2;m++){S[0]=o[0]-65517;for(let V=1;V<15;V++)S[V]=o[V]-65535-(S[V-1]>>16&1),S[V-1]&=65535;S[15]=o[15]-32767-(S[14]>>16&1);const q=S[15]>>16&1;S[14]&=65535,P(o,S,1-q)}for(let m=0;m<16;m++)O[2*m]=o[m]&255,O[2*m+1]=o[m]>>8}function L(O,I){let S=0;for(let o=0;o<32;o++)S|=O[o]^I[o];return(1&S-1>>>8)-1}function l(O,I){const S=new Uint8Array(32),o=new Uint8Array(32);return T(S,O),T(o,I),L(S,o)}function b(O){const I=new Uint8Array(32);return T(I,O),I[0]&1}function f(O,I){for(let S=0;S<16;S++)O[S]=I[2*S]+(I[2*S+1]<<8);O[15]&=32767}function g(O,I,S){for(let o=0;o<16;o++)O[o]=I[o]+S[o]}function p(O,I,S){for(let o=0;o<16;o++)O[o]=I[o]-S[o]}function n(O,I,S){let o,m,q=0,V=0,le=0,be=0,de=0,me=0,Re=0,Ne=0,ye=0,ge=0,fe=0,he=0,ce=0,oe=0,ne=0,ee=0,ue=0,pe=0,te=0,_e=0,we=0,ve=0,De=0,Ee=0,_t=0,Et=0,Ct=0,ut=0,zt=0,cr=0,Cr=0,Le=S[0],Ce=S[1],Me=S[2],$e=S[3],je=S[4],Pe=S[5],He=S[6],qe=S[7],Ke=S[8],Ve=S[9],Ge=S[10],Be=S[11],ze=S[12],Te=S[13],ke=S[14],We=S[15];o=I[0],q+=o*Le,V+=o*Ce,le+=o*Me,be+=o*$e,de+=o*je,me+=o*Pe,Re+=o*He,Ne+=o*qe,ye+=o*Ke,ge+=o*Ve,fe+=o*Ge,he+=o*Be,ce+=o*ze,oe+=o*Te,ne+=o*ke,ee+=o*We,o=I[1],V+=o*Le,le+=o*Ce,be+=o*Me,de+=o*$e,me+=o*je,Re+=o*Pe,Ne+=o*He,ye+=o*qe,ge+=o*Ke,fe+=o*Ve,he+=o*Ge,ce+=o*Be,oe+=o*ze,ne+=o*Te,ee+=o*ke,ue+=o*We,o=I[2],le+=o*Le,be+=o*Ce,de+=o*Me,me+=o*$e,Re+=o*je,Ne+=o*Pe,ye+=o*He,ge+=o*qe,fe+=o*Ke,he+=o*Ve,ce+=o*Ge,oe+=o*Be,ne+=o*ze,ee+=o*Te,ue+=o*ke,pe+=o*We,o=I[3],be+=o*Le,de+=o*Ce,me+=o*Me,Re+=o*$e,Ne+=o*je,ye+=o*Pe,ge+=o*He,fe+=o*qe,he+=o*Ke,ce+=o*Ve,oe+=o*Ge,ne+=o*Be,ee+=o*ze,ue+=o*Te,pe+=o*ke,te+=o*We,o=I[4],de+=o*Le,me+=o*Ce,Re+=o*Me,Ne+=o*$e,ye+=o*je,ge+=o*Pe,fe+=o*He,he+=o*qe,ce+=o*Ke,oe+=o*Ve,ne+=o*Ge,ee+=o*Be,ue+=o*ze,pe+=o*Te,te+=o*ke,_e+=o*We,o=I[5],me+=o*Le,Re+=o*Ce,Ne+=o*Me,ye+=o*$e,ge+=o*je,fe+=o*Pe,he+=o*He,ce+=o*qe,oe+=o*Ke,ne+=o*Ve,ee+=o*Ge,ue+=o*Be,pe+=o*ze,te+=o*Te,_e+=o*ke,we+=o*We,o=I[6],Re+=o*Le,Ne+=o*Ce,ye+=o*Me,ge+=o*$e,fe+=o*je,he+=o*Pe,ce+=o*He,oe+=o*qe,ne+=o*Ke,ee+=o*Ve,ue+=o*Ge,pe+=o*Be,te+=o*ze,_e+=o*Te,we+=o*ke,ve+=o*We,o=I[7],Ne+=o*Le,ye+=o*Ce,ge+=o*Me,fe+=o*$e,he+=o*je,ce+=o*Pe,oe+=o*He,ne+=o*qe,ee+=o*Ke,ue+=o*Ve,pe+=o*Ge,te+=o*Be,_e+=o*ze,we+=o*Te,ve+=o*ke,De+=o*We,o=I[8],ye+=o*Le,ge+=o*Ce,fe+=o*Me,he+=o*$e,ce+=o*je,oe+=o*Pe,ne+=o*He,ee+=o*qe,ue+=o*Ke,pe+=o*Ve,te+=o*Ge,_e+=o*Be,we+=o*ze,ve+=o*Te,De+=o*ke,Ee+=o*We,o=I[9],ge+=o*Le,fe+=o*Ce,he+=o*Me,ce+=o*$e,oe+=o*je,ne+=o*Pe,ee+=o*He,ue+=o*qe,pe+=o*Ke,te+=o*Ve,_e+=o*Ge,we+=o*Be,ve+=o*ze,De+=o*Te,Ee+=o*ke,_t+=o*We,o=I[10],fe+=o*Le,he+=o*Ce,ce+=o*Me,oe+=o*$e,ne+=o*je,ee+=o*Pe,ue+=o*He,pe+=o*qe,te+=o*Ke,_e+=o*Ve,we+=o*Ge,ve+=o*Be,De+=o*ze,Ee+=o*Te,_t+=o*ke,Et+=o*We,o=I[11],he+=o*Le,ce+=o*Ce,oe+=o*Me,ne+=o*$e,ee+=o*je,ue+=o*Pe,pe+=o*He,te+=o*qe,_e+=o*Ke,we+=o*Ve,ve+=o*Ge,De+=o*Be,Ee+=o*ze,_t+=o*Te,Et+=o*ke,Ct+=o*We,o=I[12],ce+=o*Le,oe+=o*Ce,ne+=o*Me,ee+=o*$e,ue+=o*je,pe+=o*Pe,te+=o*He,_e+=o*qe,we+=o*Ke,ve+=o*Ve,De+=o*Ge,Ee+=o*Be,_t+=o*ze,Et+=o*Te,Ct+=o*ke,ut+=o*We,o=I[13],oe+=o*Le,ne+=o*Ce,ee+=o*Me,ue+=o*$e,pe+=o*je,te+=o*Pe,_e+=o*He,we+=o*qe,ve+=o*Ke,De+=o*Ve,Ee+=o*Ge,_t+=o*Be,Et+=o*ze,Ct+=o*Te,ut+=o*ke,zt+=o*We,o=I[14],ne+=o*Le,ee+=o*Ce,ue+=o*Me,pe+=o*$e,te+=o*je,_e+=o*Pe,we+=o*He,ve+=o*qe,De+=o*Ke,Ee+=o*Ve,_t+=o*Ge,Et+=o*Be,Ct+=o*ze,ut+=o*Te,zt+=o*ke,cr+=o*We,o=I[15],ee+=o*Le,ue+=o*Ce,pe+=o*Me,te+=o*$e,_e+=o*je,we+=o*Pe,ve+=o*He,De+=o*qe,Ee+=o*Ke,_t+=o*Ve,Et+=o*Ge,Ct+=o*Be,ut+=o*ze,zt+=o*Te,cr+=o*ke,Cr+=o*We,q+=38*ue,V+=38*pe,le+=38*te,be+=38*_e,de+=38*we,me+=38*ve,Re+=38*De,Ne+=38*Ee,ye+=38*_t,ge+=38*Et,fe+=38*Ct,he+=38*ut,ce+=38*zt,oe+=38*cr,ne+=38*Cr,m=1,o=q+m+65535,m=Math.floor(o/65536),q=o-m*65536,o=V+m+65535,m=Math.floor(o/65536),V=o-m*65536,o=le+m+65535,m=Math.floor(o/65536),le=o-m*65536,o=be+m+65535,m=Math.floor(o/65536),be=o-m*65536,o=de+m+65535,m=Math.floor(o/65536),de=o-m*65536,o=me+m+65535,m=Math.floor(o/65536),me=o-m*65536,o=Re+m+65535,m=Math.floor(o/65536),Re=o-m*65536,o=Ne+m+65535,m=Math.floor(o/65536),Ne=o-m*65536,o=ye+m+65535,m=Math.floor(o/65536),ye=o-m*65536,o=ge+m+65535,m=Math.floor(o/65536),ge=o-m*65536,o=fe+m+65535,m=Math.floor(o/65536),fe=o-m*65536,o=he+m+65535,m=Math.floor(o/65536),he=o-m*65536,o=ce+m+65535,m=Math.floor(o/65536),ce=o-m*65536,o=oe+m+65535,m=Math.floor(o/65536),oe=o-m*65536,o=ne+m+65535,m=Math.floor(o/65536),ne=o-m*65536,o=ee+m+65535,m=Math.floor(o/65536),ee=o-m*65536,q+=m-1+37*(m-1),m=1,o=q+m+65535,m=Math.floor(o/65536),q=o-m*65536,o=V+m+65535,m=Math.floor(o/65536),V=o-m*65536,o=le+m+65535,m=Math.floor(o/65536),le=o-m*65536,o=be+m+65535,m=Math.floor(o/65536),be=o-m*65536,o=de+m+65535,m=Math.floor(o/65536),de=o-m*65536,o=me+m+65535,m=Math.floor(o/65536),me=o-m*65536,o=Re+m+65535,m=Math.floor(o/65536),Re=o-m*65536,o=Ne+m+65535,m=Math.floor(o/65536),Ne=o-m*65536,o=ye+m+65535,m=Math.floor(o/65536),ye=o-m*65536,o=ge+m+65535,m=Math.floor(o/65536),ge=o-m*65536,o=fe+m+65535,m=Math.floor(o/65536),fe=o-m*65536,o=he+m+65535,m=Math.floor(o/65536),he=o-m*65536,o=ce+m+65535,m=Math.floor(o/65536),ce=o-m*65536,o=oe+m+65535,m=Math.floor(o/65536),oe=o-m*65536,o=ne+m+65535,m=Math.floor(o/65536),ne=o-m*65536,o=ee+m+65535,m=Math.floor(o/65536),ee=o-m*65536,q+=m-1+37*(m-1),O[0]=q,O[1]=V,O[2]=le,O[3]=be,O[4]=de,O[5]=me,O[6]=Re,O[7]=Ne,O[8]=ye,O[9]=ge,O[10]=fe,O[11]=he,O[12]=ce,O[13]=oe,O[14]=ne,O[15]=ee}function d(O,I){n(O,I,I)}function F(O,I){const S=s();let o;for(o=0;o<16;o++)S[o]=I[o];for(o=253;o>=0;o--)d(S,S),o!==2&&o!==4&&n(S,S,I);for(o=0;o<16;o++)O[o]=S[o]}function j(O,I){const S=s();let o;for(o=0;o<16;o++)S[o]=I[o];for(o=250;o>=0;o--)d(S,S),o!==1&&n(S,S,I);for(o=0;o<16;o++)O[o]=S[o]}function Y(O,I){const S=s(),o=s(),m=s(),q=s(),V=s(),le=s(),be=s(),de=s(),me=s();p(S,O[1],O[0]),p(me,I[1],I[0]),n(S,S,me),g(o,O[0],O[1]),g(me,I[0],I[1]),n(o,o,me),n(m,O[3],I[3]),n(m,m,w),n(q,O[2],I[2]),g(q,q,q),p(V,o,S),p(le,q,m),g(be,q,m),g(de,o,S),n(O[0],V,le),n(O[1],de,be),n(O[2],be,le),n(O[3],V,de)}function J(O,I,S){for(let o=0;o<4;o++)P(O[o],I[o],S)}function X(O,I){const S=s(),o=s(),m=s();F(m,I[2]),n(S,I[0],m),n(o,I[1],m),T(O,o),O[31]^=b(S)<<7}function N(O,I,S){v(O[0],u),v(O[1],a),v(O[2],a),v(O[3],u);for(let o=255;o>=0;--o){const m=S[o/8|0]>>(o&7)&1;J(O,I,m),Y(I,O),Y(O,O),J(O,I,m)}}function A(O,I){const S=[s(),s(),s(),s()];v(S[0],_),v(S[1],E),v(S[2],a),n(S[3],_,E),N(O,S,I)}function k(O){if(O.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const I=(0,r.hash)(O);I[0]&=248,I[31]&=127,I[31]|=64;const S=new Uint8Array(32),o=[s(),s(),s(),s()];A(o,I),X(S,o);const m=new Uint8Array(64);return m.set(O),m.set(S,32),{publicKey:S,secretKey:m}}t.generateKeyPairFromSeed=k;function z(O){const I=(0,e.randomBytes)(32,O),S=k(I);return(0,i.wipe)(I),S}t.generateKeyPair=z;function U(O){if(O.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(O.subarray(32))}t.extractPublicKeyFromSecretKey=U;const M=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function $(O,I){let S,o,m,q;for(o=63;o>=32;--o){for(S=0,m=o-32,q=o-12;m<q;++m)I[m]+=S-16*I[o]*M[m-(o-32)],S=Math.floor((I[m]+128)/256),I[m]-=S*256;I[m]+=S,I[o]=0}for(S=0,m=0;m<32;m++)I[m]+=S-(I[31]>>4)*M[m],S=I[m]>>8,I[m]&=255;for(m=0;m<32;m++)I[m]-=S*M[m];for(o=0;o<32;o++)I[o+1]+=I[o]>>8,O[o]=I[o]&255}function B(O){const I=new Float64Array(64);for(let S=0;S<64;S++)I[S]=O[S];for(let S=0;S<64;S++)O[S]=0;$(O,I)}function ie(O,I){const S=new Float64Array(64),o=[s(),s(),s(),s()],m=(0,r.hash)(O.subarray(0,32));m[0]&=248,m[31]&=127,m[31]|=64;const q=new Uint8Array(64);q.set(m.subarray(32),32);const V=new r.SHA512;V.update(q.subarray(32)),V.update(I);const le=V.digest();V.clean(),B(le),A(o,le),X(q,o),V.reset(),V.update(q.subarray(0,32)),V.update(O.subarray(32)),V.update(I);const be=V.digest();B(be);for(let de=0;de<32;de++)S[de]=le[de];for(let de=0;de<32;de++)for(let me=0;me<32;me++)S[de+me]+=be[de]*m[me];return $(q.subarray(32),S),q}t.sign=ie;function H(O,I){const S=s(),o=s(),m=s(),q=s(),V=s(),le=s(),be=s();return v(O[2],a),f(O[1],I),d(m,O[1]),n(q,m,h),p(m,m,O[2]),g(q,O[2],q),d(V,q),d(le,V),n(be,le,V),n(S,be,m),n(S,S,q),j(S,S),n(S,S,m),n(S,S,q),n(S,S,q),n(O[0],S,q),d(o,O[0]),n(o,o,q),l(o,m)&&n(O[0],O[0],C),d(o,O[0]),n(o,o,q),l(o,m)?-1:(b(O[0])===I[31]>>7&&p(O[0],u,O[0]),n(O[3],O[0],O[1]),0)}function Z(O,I,S){const o=new Uint8Array(32),m=[s(),s(),s(),s()],q=[s(),s(),s(),s()];if(S.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(H(q,O))return!1;const V=new r.SHA512;V.update(S.subarray(0,32)),V.update(O),V.update(I);const le=V.digest();return B(le),N(m,q,le),A(q,S.subarray(32)),Y(m,q),X(o,m),!L(S,o)}t.verify=Z;function W(O){let I=[s(),s(),s(),s()];if(H(I,O))throw new Error("Ed25519: invalid public key");let S=s(),o=s(),m=I[1];g(S,a,m),p(o,a,m),F(o,o),n(S,S,o);let q=new Uint8Array(32);return T(q,S),q}t.convertPublicKeyToX25519=W;function ae(O){const I=(0,r.hash)(O.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const S=new Uint8Array(I.subarray(0,32));return(0,i.wipe)(I),S}t.convertSecretKeyToX25519=ae})(zi);const oh="EdDSA",ah="JWT",to=".",ro="base64url",ch="utf8",hh="utf8",uh=":",lh="did",fh="key",Ls="base58btc",dh="z",gh="K36",ph=32;function io(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Si(t,e){e||(e=t.reduce((s,c)=>s+c.length,0));const r=io(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return r}function yh(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var c=t.charAt(s),u=c.charCodeAt(0);if(r[u]!==255)throw new TypeError(c+" is ambiguous");r[u]=s}var a=t.length,h=t.charAt(0),w=Math.log(a)/Math.log(256),_=Math.log(256)/Math.log(a);function E(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var P=0,T=0,L=0,l=D.length;L!==l&&D[L]===0;)L++,P++;for(var b=(l-L)*_+1>>>0,f=new Uint8Array(b);L!==l;){for(var g=D[L],p=0,n=b-1;(g!==0||p<T)&&n!==-1;n--,p++)g+=256*f[n]>>>0,f[n]=g%a>>>0,g=g/a>>>0;if(g!==0)throw new Error("Non-zero carry");T=p,L++}for(var d=b-T;d!==b&&f[d]===0;)d++;for(var F=h.repeat(P);d<b;++d)F+=t.charAt(f[d]);return F}function C(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var P=0;if(D[P]!==" "){for(var T=0,L=0;D[P]===h;)T++,P++;for(var l=(D.length-P)*w+1>>>0,b=new Uint8Array(l);D[P];){var f=r[D.charCodeAt(P)];if(f===255)return;for(var g=0,p=l-1;(f!==0||g<L)&&p!==-1;p--,g++)f+=a*b[p]>>>0,b[p]=f%256>>>0,f=f/256>>>0;if(f!==0)throw new Error("Non-zero carry");L=g,P++}if(D[P]!==" "){for(var n=l-L;n!==l&&b[n]===0;)n++;for(var d=new Uint8Array(T+(l-n)),F=T;n!==l;)d[F++]=b[n++];return d}}}function v(D){var P=C(D);if(P)return P;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:C,decode:v}}var bh=yh,_h=bh;const wh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},mh=t=>new TextEncoder().encode(t),Eh=t=>new TextDecoder().decode(t);class vh{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Dh{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return so(this,e)}}class Sh{constructor(e){this.decoders=e}or(e){return so(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const so=(t,e)=>new Sh({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class xh{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new vh(e,r,i),this.decoder=new Dh(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Qr=({name:t,prefix:e,encode:r,decode:i})=>new xh(t,e,r,i),Ir=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=_h(r,e);return Qr({prefix:t,name:e,encode:i,decode:c=>wh(s(c))})},Ih=(t,e,r,i)=>{const s={};for(let _=0;_<e.length;++_)s[e[_]]=_;let c=t.length;for(;t[c-1]==="=";)--c;const u=new Uint8Array(c*r/8|0);let a=0,h=0,w=0;for(let _=0;_<c;++_){const E=s[t[_]];if(E===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|E,a+=r,a>=8&&(a-=8,u[w++]=255&h>>a)}if(a>=r||255&h<<8-a)throw new SyntaxError("Unexpected end of data");return u},Oh=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let c="",u=0,a=0;for(let h=0;h<t.length;++h)for(a=a<<8|t[h],u+=8;u>r;)u-=r,c+=e[s&a>>u];if(u&&(c+=e[s&a<<r-u]),i)for(;c.length*r&7;)c+="=";return c},Qe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Qr({prefix:e,name:t,encode(s){return Oh(s,i,r)},decode(s){return Ih(s,i,r,t)}}),Th=Qr({prefix:"\0",name:"identity",encode:t=>Eh(t),decode:t=>mh(t)}),Ah=Object.freeze(Object.defineProperty({__proto__:null,identity:Th},Symbol.toStringTag,{value:"Module"})),Nh=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ch=Object.freeze(Object.defineProperty({__proto__:null,base2:Nh},Symbol.toStringTag,{value:"Module"})),Ph=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Fh=Object.freeze(Object.defineProperty({__proto__:null,base8:Ph},Symbol.toStringTag,{value:"Module"})),Rh=Ir({prefix:"9",name:"base10",alphabet:"0123456789"}),Uh=Object.freeze(Object.defineProperty({__proto__:null,base10:Rh},Symbol.toStringTag,{value:"Module"})),Lh=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Mh=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),$h=Object.freeze(Object.defineProperty({__proto__:null,base16:Lh,base16upper:Mh},Symbol.toStringTag,{value:"Module"})),jh=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),zh=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Bh=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Hh=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),qh=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Kh=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Vh=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Gh=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kh=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Wh=Object.freeze(Object.defineProperty({__proto__:null,base32:jh,base32upper:zh,base32pad:Bh,base32padupper:Hh,base32hex:qh,base32hexupper:Kh,base32hexpad:Vh,base32hexpadupper:Gh,base32z:kh},Symbol.toStringTag,{value:"Module"})),Yh=Ir({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Jh=Ir({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Xh=Object.freeze(Object.defineProperty({__proto__:null,base36:Yh,base36upper:Jh},Symbol.toStringTag,{value:"Module"})),Zh=Ir({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Qh=Ir({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),eu=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Zh,base58flickr:Qh},Symbol.toStringTag,{value:"Module"})),tu=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ru=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),iu=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),su=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),nu=Object.freeze(Object.defineProperty({__proto__:null,base64:tu,base64pad:ru,base64url:iu,base64urlpad:su},Symbol.toStringTag,{value:"Module"})),no=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),ou=no.reduce((t,e,r)=>(t[r]=e,t),[]),au=no.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function cu(t){return t.reduce((e,r)=>(e+=ou[r],e),"")}function hu(t){const e=[];for(const r of t){const i=au[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const uu=Qr({prefix:"🚀",name:"base256emoji",encode:cu,decode:hu}),lu=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:uu},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Ms={...Ah,...Ch,...Fh,...Uh,...$h,...Wh,...Xh,...eu,...nu,...lu};function oo(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const $s=oo("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),gi=oo("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=io(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),ao={utf8:$s,"utf-8":$s,hex:Ms.base16,latin1:gi,ascii:gi,binary:gi,...Ms};function ht(t,e="utf8"){const r=ao[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function at(t,e="utf8"){const r=ao[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function Vr(t){return ht(at(Ri(t),ch),ro)}function co(t){const e=at(gh,Ls),r=dh+ht(Si([e,t]),Ls);return[lh,fh,r].join(uh)}function fu(t){return ht(t,ro)}function du(t){return at([Vr(t.header),Vr(t.payload)].join(to),hh)}function gu(t){return[Vr(t.header),Vr(t.payload),fu(t.signature)].join(to)}function js(t=nr.randomBytes(ph)){return zi.generateKeyPairFromSeed(t)}async function pu(t,e,r,i,s=Q.fromMiliseconds(Date.now())){const c={alg:oh,typ:ah},u=co(i.publicKey),a=s+r,h={iss:u,sub:t,aud:e,iat:s,exp:a},w=du({header:c,payload:h}),_=zi.sign(i.secretKey,w);return gu({header:c,payload:h,signature:_})}var Bi={},ei={};Object.defineProperty(ei,"__esModule",{value:!0});var rt=re,xi=ft,yu=20;function bu(t,e,r){for(var i=1634760805,s=857760878,c=2036477234,u=1797285236,a=r[3]<<24|r[2]<<16|r[1]<<8|r[0],h=r[7]<<24|r[6]<<16|r[5]<<8|r[4],w=r[11]<<24|r[10]<<16|r[9]<<8|r[8],_=r[15]<<24|r[14]<<16|r[13]<<8|r[12],E=r[19]<<24|r[18]<<16|r[17]<<8|r[16],C=r[23]<<24|r[22]<<16|r[21]<<8|r[20],v=r[27]<<24|r[26]<<16|r[25]<<8|r[24],D=r[31]<<24|r[30]<<16|r[29]<<8|r[28],P=e[3]<<24|e[2]<<16|e[1]<<8|e[0],T=e[7]<<24|e[6]<<16|e[5]<<8|e[4],L=e[11]<<24|e[10]<<16|e[9]<<8|e[8],l=e[15]<<24|e[14]<<16|e[13]<<8|e[12],b=i,f=s,g=c,p=u,n=a,d=h,F=w,j=_,Y=E,J=C,X=v,N=D,A=P,k=T,z=L,U=l,M=0;M<yu;M+=2)b=b+n|0,A^=b,A=A>>>32-16|A<<16,Y=Y+A|0,n^=Y,n=n>>>32-12|n<<12,f=f+d|0,k^=f,k=k>>>32-16|k<<16,J=J+k|0,d^=J,d=d>>>32-12|d<<12,g=g+F|0,z^=g,z=z>>>32-16|z<<16,X=X+z|0,F^=X,F=F>>>32-12|F<<12,p=p+j|0,U^=p,U=U>>>32-16|U<<16,N=N+U|0,j^=N,j=j>>>32-12|j<<12,g=g+F|0,z^=g,z=z>>>32-8|z<<8,X=X+z|0,F^=X,F=F>>>32-7|F<<7,p=p+j|0,U^=p,U=U>>>32-8|U<<8,N=N+U|0,j^=N,j=j>>>32-7|j<<7,f=f+d|0,k^=f,k=k>>>32-8|k<<8,J=J+k|0,d^=J,d=d>>>32-7|d<<7,b=b+n|0,A^=b,A=A>>>32-8|A<<8,Y=Y+A|0,n^=Y,n=n>>>32-7|n<<7,b=b+d|0,U^=b,U=U>>>32-16|U<<16,X=X+U|0,d^=X,d=d>>>32-12|d<<12,f=f+F|0,A^=f,A=A>>>32-16|A<<16,N=N+A|0,F^=N,F=F>>>32-12|F<<12,g=g+j|0,k^=g,k=k>>>32-16|k<<16,Y=Y+k|0,j^=Y,j=j>>>32-12|j<<12,p=p+n|0,z^=p,z=z>>>32-16|z<<16,J=J+z|0,n^=J,n=n>>>32-12|n<<12,g=g+j|0,k^=g,k=k>>>32-8|k<<8,Y=Y+k|0,j^=Y,j=j>>>32-7|j<<7,p=p+n|0,z^=p,z=z>>>32-8|z<<8,J=J+z|0,n^=J,n=n>>>32-7|n<<7,f=f+F|0,A^=f,A=A>>>32-8|A<<8,N=N+A|0,F^=N,F=F>>>32-7|F<<7,b=b+d|0,U^=b,U=U>>>32-8|U<<8,X=X+U|0,d^=X,d=d>>>32-7|d<<7;rt.writeUint32LE(b+i|0,t,0),rt.writeUint32LE(f+s|0,t,4),rt.writeUint32LE(g+c|0,t,8),rt.writeUint32LE(p+u|0,t,12),rt.writeUint32LE(n+a|0,t,16),rt.writeUint32LE(d+h|0,t,20),rt.writeUint32LE(F+w|0,t,24),rt.writeUint32LE(j+_|0,t,28),rt.writeUint32LE(Y+E|0,t,32),rt.writeUint32LE(J+C|0,t,36),rt.writeUint32LE(X+v|0,t,40),rt.writeUint32LE(N+D|0,t,44),rt.writeUint32LE(A+P|0,t,48),rt.writeUint32LE(k+T|0,t,52),rt.writeUint32LE(z+L|0,t,56),rt.writeUint32LE(U+l|0,t,60)}function ho(t,e,r,i,s){if(s===void 0&&(s=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var c,u;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");c=new Uint8Array(16),u=c.length-e.length,c.set(e,u)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");c=e,u=s}for(var a=new Uint8Array(64),h=0;h<r.length;h+=64){bu(a,c,t);for(var w=h;w<h+64&&w<r.length;w++)i[w]=r[w]^a[w-h];wu(c,0,u)}return xi.wipe(a),s===0&&xi.wipe(c),i}ei.streamXOR=ho;function _u(t,e,r,i){return i===void 0&&(i=0),xi.wipe(r),ho(t,e,r,r,i)}ei.stream=_u;function wu(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var uo={},jt={};Object.defineProperty(jt,"__esModule",{value:!0});function mu(t,e,r){return~(t-1)&e|t-1&r}jt.select=mu;function Eu(t,e){return(t|0)-(e|0)-1>>>31&1}jt.lessOrEqual=Eu;function lo(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}jt.compare=lo;function vu(t,e){return t.length===0||e.length===0?!1:lo(t,e)!==0}jt.equal=vu;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=jt,r=ft;t.DIGEST_LENGTH=16;var i=function(){function u(a){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=a[0]|a[1]<<8;this._r[0]=h&8191;var w=a[2]|a[3]<<8;this._r[1]=(h>>>13|w<<3)&8191;var _=a[4]|a[5]<<8;this._r[2]=(w>>>10|_<<6)&7939;var E=a[6]|a[7]<<8;this._r[3]=(_>>>7|E<<9)&8191;var C=a[8]|a[9]<<8;this._r[4]=(E>>>4|C<<12)&255,this._r[5]=C>>>1&8190;var v=a[10]|a[11]<<8;this._r[6]=(C>>>14|v<<2)&8191;var D=a[12]|a[13]<<8;this._r[7]=(v>>>11|D<<5)&8065;var P=a[14]|a[15]<<8;this._r[8]=(D>>>8|P<<8)&8191,this._r[9]=P>>>5&127,this._pad[0]=a[16]|a[17]<<8,this._pad[1]=a[18]|a[19]<<8,this._pad[2]=a[20]|a[21]<<8,this._pad[3]=a[22]|a[23]<<8,this._pad[4]=a[24]|a[25]<<8,this._pad[5]=a[26]|a[27]<<8,this._pad[6]=a[28]|a[29]<<8,this._pad[7]=a[30]|a[31]<<8}return u.prototype._blocks=function(a,h,w){for(var _=this._fin?0:2048,E=this._h[0],C=this._h[1],v=this._h[2],D=this._h[3],P=this._h[4],T=this._h[5],L=this._h[6],l=this._h[7],b=this._h[8],f=this._h[9],g=this._r[0],p=this._r[1],n=this._r[2],d=this._r[3],F=this._r[4],j=this._r[5],Y=this._r[6],J=this._r[7],X=this._r[8],N=this._r[9];w>=16;){var A=a[h+0]|a[h+1]<<8;E+=A&8191;var k=a[h+2]|a[h+3]<<8;C+=(A>>>13|k<<3)&8191;var z=a[h+4]|a[h+5]<<8;v+=(k>>>10|z<<6)&8191;var U=a[h+6]|a[h+7]<<8;D+=(z>>>7|U<<9)&8191;var M=a[h+8]|a[h+9]<<8;P+=(U>>>4|M<<12)&8191,T+=M>>>1&8191;var $=a[h+10]|a[h+11]<<8;L+=(M>>>14|$<<2)&8191;var B=a[h+12]|a[h+13]<<8;l+=($>>>11|B<<5)&8191;var ie=a[h+14]|a[h+15]<<8;b+=(B>>>8|ie<<8)&8191,f+=ie>>>5|_;var H=0,Z=H;Z+=E*g,Z+=C*(5*N),Z+=v*(5*X),Z+=D*(5*J),Z+=P*(5*Y),H=Z>>>13,Z&=8191,Z+=T*(5*j),Z+=L*(5*F),Z+=l*(5*d),Z+=b*(5*n),Z+=f*(5*p),H+=Z>>>13,Z&=8191;var W=H;W+=E*p,W+=C*g,W+=v*(5*N),W+=D*(5*X),W+=P*(5*J),H=W>>>13,W&=8191,W+=T*(5*Y),W+=L*(5*j),W+=l*(5*F),W+=b*(5*d),W+=f*(5*n),H+=W>>>13,W&=8191;var ae=H;ae+=E*n,ae+=C*p,ae+=v*g,ae+=D*(5*N),ae+=P*(5*X),H=ae>>>13,ae&=8191,ae+=T*(5*J),ae+=L*(5*Y),ae+=l*(5*j),ae+=b*(5*F),ae+=f*(5*d),H+=ae>>>13,ae&=8191;var O=H;O+=E*d,O+=C*n,O+=v*p,O+=D*g,O+=P*(5*N),H=O>>>13,O&=8191,O+=T*(5*X),O+=L*(5*J),O+=l*(5*Y),O+=b*(5*j),O+=f*(5*F),H+=O>>>13,O&=8191;var I=H;I+=E*F,I+=C*d,I+=v*n,I+=D*p,I+=P*g,H=I>>>13,I&=8191,I+=T*(5*N),I+=L*(5*X),I+=l*(5*J),I+=b*(5*Y),I+=f*(5*j),H+=I>>>13,I&=8191;var S=H;S+=E*j,S+=C*F,S+=v*d,S+=D*n,S+=P*p,H=S>>>13,S&=8191,S+=T*g,S+=L*(5*N),S+=l*(5*X),S+=b*(5*J),S+=f*(5*Y),H+=S>>>13,S&=8191;var o=H;o+=E*Y,o+=C*j,o+=v*F,o+=D*d,o+=P*n,H=o>>>13,o&=8191,o+=T*p,o+=L*g,o+=l*(5*N),o+=b*(5*X),o+=f*(5*J),H+=o>>>13,o&=8191;var m=H;m+=E*J,m+=C*Y,m+=v*j,m+=D*F,m+=P*d,H=m>>>13,m&=8191,m+=T*n,m+=L*p,m+=l*g,m+=b*(5*N),m+=f*(5*X),H+=m>>>13,m&=8191;var q=H;q+=E*X,q+=C*J,q+=v*Y,q+=D*j,q+=P*F,H=q>>>13,q&=8191,q+=T*d,q+=L*n,q+=l*p,q+=b*g,q+=f*(5*N),H+=q>>>13,q&=8191;var V=H;V+=E*N,V+=C*X,V+=v*J,V+=D*Y,V+=P*j,H=V>>>13,V&=8191,V+=T*F,V+=L*d,V+=l*n,V+=b*p,V+=f*g,H+=V>>>13,V&=8191,H=(H<<2)+H|0,H=H+Z|0,Z=H&8191,H=H>>>13,W+=H,E=Z,C=W,v=ae,D=O,P=I,T=S,L=o,l=m,b=q,f=V,h+=16,w-=16}this._h[0]=E,this._h[1]=C,this._h[2]=v,this._h[3]=D,this._h[4]=P,this._h[5]=T,this._h[6]=L,this._h[7]=l,this._h[8]=b,this._h[9]=f},u.prototype.finish=function(a,h){h===void 0&&(h=0);var w=new Uint16Array(10),_,E,C,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(_=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=_,_=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=_*5,_=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=_,_=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=_,w[0]=this._h[0]+5,_=w[0]>>>13,w[0]&=8191,v=1;v<10;v++)w[v]=this._h[v]+_,_=w[v]>>>13,w[v]&=8191;for(w[9]-=1<<13,E=(_^1)-1,v=0;v<10;v++)w[v]&=E;for(E=~E,v=0;v<10;v++)this._h[v]=this._h[v]&E|w[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,C=this._h[0]+this._pad[0],this._h[0]=C&65535,v=1;v<8;v++)C=(this._h[v]+this._pad[v]|0)+(C>>>16)|0,this._h[v]=C&65535;return a[h+0]=this._h[0]>>>0,a[h+1]=this._h[0]>>>8,a[h+2]=this._h[1]>>>0,a[h+3]=this._h[1]>>>8,a[h+4]=this._h[2]>>>0,a[h+5]=this._h[2]>>>8,a[h+6]=this._h[3]>>>0,a[h+7]=this._h[3]>>>8,a[h+8]=this._h[4]>>>0,a[h+9]=this._h[4]>>>8,a[h+10]=this._h[5]>>>0,a[h+11]=this._h[5]>>>8,a[h+12]=this._h[6]>>>0,a[h+13]=this._h[6]>>>8,a[h+14]=this._h[7]>>>0,a[h+15]=this._h[7]>>>8,this._finished=!0,this},u.prototype.update=function(a){var h=0,w=a.length,_;if(this._leftover){_=16-this._leftover,_>w&&(_=w);for(var E=0;E<_;E++)this._buffer[this._leftover+E]=a[h+E];if(w-=_,h+=_,this._leftover+=_,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(w>=16&&(_=w-w%16,this._blocks(a,h,_),h+=_,w-=_),w){for(var E=0;E<w;E++)this._buffer[this._leftover+E]=a[h+E];this._leftover+=w}return this},u.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var a=new Uint8Array(16);return this.finish(a),a},u.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},u}();t.Poly1305=i;function s(u,a){var h=new i(u);h.update(a);var w=h.digest();return h.clean(),w}t.oneTimeAuth=s;function c(u,a){return u.length!==t.DIGEST_LENGTH||a.length!==t.DIGEST_LENGTH?!1:e.equal(u,a)}t.equal=c})(uo);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ei,r=uo,i=ft,s=re,c=jt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var u=new Uint8Array(16),a=function(){function h(w){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,w.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(w)}return h.prototype.seal=function(w,_,E,C){if(w.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(w,v.length-w.length);var D=new Uint8Array(32);e.stream(this._key,v,D,4);var P=_.length+this.tagLength,T;if(C){if(C.length!==P)throw new Error("ChaCha20Poly1305: incorrect destination length");T=C}else T=new Uint8Array(P);return e.streamXOR(this._key,v,_,T,4),this._authenticate(T.subarray(T.length-this.tagLength,T.length),D,T.subarray(0,T.length-this.tagLength),E),i.wipe(v),T},h.prototype.open=function(w,_,E,C){if(w.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(_.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(w,v.length-w.length);var D=new Uint8Array(32);e.stream(this._key,v,D,4);var P=new Uint8Array(this.tagLength);if(this._authenticate(P,D,_.subarray(0,_.length-this.tagLength),E),!c.equal(P,_.subarray(_.length-this.tagLength,_.length)))return null;var T=_.length-this.tagLength,L;if(C){if(C.length!==T)throw new Error("ChaCha20Poly1305: incorrect destination length");L=C}else L=new Uint8Array(T);return e.streamXOR(this._key,v,_.subarray(0,_.length-this.tagLength),L,4),i.wipe(v),L},h.prototype.clean=function(){return i.wipe(this._key),this},h.prototype._authenticate=function(w,_,E,C){var v=new r.Poly1305(_);C&&(v.update(C),C.length%16>0&&v.update(u.subarray(C.length%16))),v.update(E),E.length%16>0&&v.update(u.subarray(E.length%16));var D=new Uint8Array(8);C&&s.writeUint64LE(C.length,D),v.update(D),s.writeUint64LE(E.length,D),v.update(D);for(var P=v.digest(),T=0;T<P.length;T++)w[T]=P[T];v.clean(),i.wipe(P),i.wipe(D)},h}();t.ChaCha20Poly1305=a})(Bi);var fo={},Or={},Hi={};Object.defineProperty(Hi,"__esModule",{value:!0});function Du(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}Hi.isSerializableHash=Du;Object.defineProperty(Or,"__esModule",{value:!0});var vt=Hi,Su=jt,xu=ft,go=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),vt.isSerializableHash(this._inner)&&vt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),xu.wipe(i)}return t.prototype.reset=function(){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){vt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),vt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Or.HMAC=go;function Iu(t,e,r){var i=new go(t,e);i.update(r);var s=i.digest();return i.clean(),s}Or.hmac=Iu;Or.equal=Su.equal;Object.defineProperty(fo,"__esModule",{value:!0});var zs=Or,Bs=ft,Ou=function(){function t(e,r,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var c=zs.hmac(this._hash,i,r);this._hmac=new zs.HMAC(e,c),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),Bs.wipe(this._buffer),Bs.wipe(this._counter),this._bufpos=0},t}(),Tu=fo.HKDF=Ou,ti={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ft;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function a(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return a.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},a.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},a.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},a.prototype.update=function(h,w){if(w===void 0&&(w=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var _=0;if(this._bytesHashed+=w,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&w>0;)this._buffer[this._bufferLength++]=h[_++],w--;this._bufferLength===this.blockSize&&(c(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(w>=this.blockSize&&(_=c(this._temp,this._state,h,_,w),w%=this.blockSize);w>0;)this._buffer[this._bufferLength++]=h[_++],w--;return this},a.prototype.finish=function(h){if(!this._finished){var w=this._bytesHashed,_=this._bufferLength,E=w/536870912|0,C=w<<3,v=w%64<56?64:128;this._buffer[_]=128;for(var D=_+1;D<v-8;D++)this._buffer[D]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(C,this._buffer,v-4),c(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var D=0;D<this.digestLength/4;D++)e.writeUint32BE(this._state[D],h,D*4);return this},a.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},a.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},a.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},a.prototype.cleanSavedState=function(h){r.wipe(h.state),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},a}();t.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function c(a,h,w,_,E){for(;E>=64;){for(var C=h[0],v=h[1],D=h[2],P=h[3],T=h[4],L=h[5],l=h[6],b=h[7],f=0;f<16;f++){var g=_+f*4;a[f]=e.readUint32BE(w,g)}for(var f=16;f<64;f++){var p=a[f-2],n=(p>>>17|p<<32-17)^(p>>>19|p<<32-19)^p>>>10;p=a[f-15];var d=(p>>>7|p<<32-7)^(p>>>18|p<<32-18)^p>>>3;a[f]=(n+a[f-7]|0)+(d+a[f-16]|0)}for(var f=0;f<64;f++){var n=(((T>>>6|T<<26)^(T>>>11|T<<21)^(T>>>25|T<<7))+(T&L^~T&l)|0)+(b+(s[f]+a[f]|0)|0)|0,d=((C>>>2|C<<32-2)^(C>>>13|C<<32-13)^(C>>>22|C<<32-22))+(C&v^C&D^v&D)|0;b=l,l=L,L=T,T=P+n|0,P=D,D=v,v=C,C=n+d|0}h[0]+=C,h[1]+=v,h[2]+=D,h[3]+=P,h[4]+=T,h[5]+=L,h[6]+=l,h[7]+=b,_+=64,E-=64}return _}function u(a){var h=new i;h.update(a);var w=h.digest();return h.clean(),w}t.hash=u})(ti);var qi={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=nr,r=ft;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(f){const g=new Float64Array(16);if(f)for(let p=0;p<f.length;p++)g[p]=f[p];return g}const s=new Uint8Array(32);s[0]=9;const c=i([56129,1]);function u(f){let g=1;for(let p=0;p<16;p++){let n=f[p]+g+65535;g=Math.floor(n/65536),f[p]=n-g*65536}f[0]+=g-1+37*(g-1)}function a(f,g,p){const n=~(p-1);for(let d=0;d<16;d++){const F=n&(f[d]^g[d]);f[d]^=F,g[d]^=F}}function h(f,g){const p=i(),n=i();for(let d=0;d<16;d++)n[d]=g[d];u(n),u(n),u(n);for(let d=0;d<2;d++){p[0]=n[0]-65517;for(let j=1;j<15;j++)p[j]=n[j]-65535-(p[j-1]>>16&1),p[j-1]&=65535;p[15]=n[15]-32767-(p[14]>>16&1);const F=p[15]>>16&1;p[14]&=65535,a(n,p,1-F)}for(let d=0;d<16;d++)f[2*d]=n[d]&255,f[2*d+1]=n[d]>>8}function w(f,g){for(let p=0;p<16;p++)f[p]=g[2*p]+(g[2*p+1]<<8);f[15]&=32767}function _(f,g,p){for(let n=0;n<16;n++)f[n]=g[n]+p[n]}function E(f,g,p){for(let n=0;n<16;n++)f[n]=g[n]-p[n]}function C(f,g,p){let n,d,F=0,j=0,Y=0,J=0,X=0,N=0,A=0,k=0,z=0,U=0,M=0,$=0,B=0,ie=0,H=0,Z=0,W=0,ae=0,O=0,I=0,S=0,o=0,m=0,q=0,V=0,le=0,be=0,de=0,me=0,Re=0,Ne=0,ye=p[0],ge=p[1],fe=p[2],he=p[3],ce=p[4],oe=p[5],ne=p[6],ee=p[7],ue=p[8],pe=p[9],te=p[10],_e=p[11],we=p[12],ve=p[13],De=p[14],Ee=p[15];n=g[0],F+=n*ye,j+=n*ge,Y+=n*fe,J+=n*he,X+=n*ce,N+=n*oe,A+=n*ne,k+=n*ee,z+=n*ue,U+=n*pe,M+=n*te,$+=n*_e,B+=n*we,ie+=n*ve,H+=n*De,Z+=n*Ee,n=g[1],j+=n*ye,Y+=n*ge,J+=n*fe,X+=n*he,N+=n*ce,A+=n*oe,k+=n*ne,z+=n*ee,U+=n*ue,M+=n*pe,$+=n*te,B+=n*_e,ie+=n*we,H+=n*ve,Z+=n*De,W+=n*Ee,n=g[2],Y+=n*ye,J+=n*ge,X+=n*fe,N+=n*he,A+=n*ce,k+=n*oe,z+=n*ne,U+=n*ee,M+=n*ue,$+=n*pe,B+=n*te,ie+=n*_e,H+=n*we,Z+=n*ve,W+=n*De,ae+=n*Ee,n=g[3],J+=n*ye,X+=n*ge,N+=n*fe,A+=n*he,k+=n*ce,z+=n*oe,U+=n*ne,M+=n*ee,$+=n*ue,B+=n*pe,ie+=n*te,H+=n*_e,Z+=n*we,W+=n*ve,ae+=n*De,O+=n*Ee,n=g[4],X+=n*ye,N+=n*ge,A+=n*fe,k+=n*he,z+=n*ce,U+=n*oe,M+=n*ne,$+=n*ee,B+=n*ue,ie+=n*pe,H+=n*te,Z+=n*_e,W+=n*we,ae+=n*ve,O+=n*De,I+=n*Ee,n=g[5],N+=n*ye,A+=n*ge,k+=n*fe,z+=n*he,U+=n*ce,M+=n*oe,$+=n*ne,B+=n*ee,ie+=n*ue,H+=n*pe,Z+=n*te,W+=n*_e,ae+=n*we,O+=n*ve,I+=n*De,S+=n*Ee,n=g[6],A+=n*ye,k+=n*ge,z+=n*fe,U+=n*he,M+=n*ce,$+=n*oe,B+=n*ne,ie+=n*ee,H+=n*ue,Z+=n*pe,W+=n*te,ae+=n*_e,O+=n*we,I+=n*ve,S+=n*De,o+=n*Ee,n=g[7],k+=n*ye,z+=n*ge,U+=n*fe,M+=n*he,$+=n*ce,B+=n*oe,ie+=n*ne,H+=n*ee,Z+=n*ue,W+=n*pe,ae+=n*te,O+=n*_e,I+=n*we,S+=n*ve,o+=n*De,m+=n*Ee,n=g[8],z+=n*ye,U+=n*ge,M+=n*fe,$+=n*he,B+=n*ce,ie+=n*oe,H+=n*ne,Z+=n*ee,W+=n*ue,ae+=n*pe,O+=n*te,I+=n*_e,S+=n*we,o+=n*ve,m+=n*De,q+=n*Ee,n=g[9],U+=n*ye,M+=n*ge,$+=n*fe,B+=n*he,ie+=n*ce,H+=n*oe,Z+=n*ne,W+=n*ee,ae+=n*ue,O+=n*pe,I+=n*te,S+=n*_e,o+=n*we,m+=n*ve,q+=n*De,V+=n*Ee,n=g[10],M+=n*ye,$+=n*ge,B+=n*fe,ie+=n*he,H+=n*ce,Z+=n*oe,W+=n*ne,ae+=n*ee,O+=n*ue,I+=n*pe,S+=n*te,o+=n*_e,m+=n*we,q+=n*ve,V+=n*De,le+=n*Ee,n=g[11],$+=n*ye,B+=n*ge,ie+=n*fe,H+=n*he,Z+=n*ce,W+=n*oe,ae+=n*ne,O+=n*ee,I+=n*ue,S+=n*pe,o+=n*te,m+=n*_e,q+=n*we,V+=n*ve,le+=n*De,be+=n*Ee,n=g[12],B+=n*ye,ie+=n*ge,H+=n*fe,Z+=n*he,W+=n*ce,ae+=n*oe,O+=n*ne,I+=n*ee,S+=n*ue,o+=n*pe,m+=n*te,q+=n*_e,V+=n*we,le+=n*ve,be+=n*De,de+=n*Ee,n=g[13],ie+=n*ye,H+=n*ge,Z+=n*fe,W+=n*he,ae+=n*ce,O+=n*oe,I+=n*ne,S+=n*ee,o+=n*ue,m+=n*pe,q+=n*te,V+=n*_e,le+=n*we,be+=n*ve,de+=n*De,me+=n*Ee,n=g[14],H+=n*ye,Z+=n*ge,W+=n*fe,ae+=n*he,O+=n*ce,I+=n*oe,S+=n*ne,o+=n*ee,m+=n*ue,q+=n*pe,V+=n*te,le+=n*_e,be+=n*we,de+=n*ve,me+=n*De,Re+=n*Ee,n=g[15],Z+=n*ye,W+=n*ge,ae+=n*fe,O+=n*he,I+=n*ce,S+=n*oe,o+=n*ne,m+=n*ee,q+=n*ue,V+=n*pe,le+=n*te,be+=n*_e,de+=n*we,me+=n*ve,Re+=n*De,Ne+=n*Ee,F+=38*W,j+=38*ae,Y+=38*O,J+=38*I,X+=38*S,N+=38*o,A+=38*m,k+=38*q,z+=38*V,U+=38*le,M+=38*be,$+=38*de,B+=38*me,ie+=38*Re,H+=38*Ne,d=1,n=F+d+65535,d=Math.floor(n/65536),F=n-d*65536,n=j+d+65535,d=Math.floor(n/65536),j=n-d*65536,n=Y+d+65535,d=Math.floor(n/65536),Y=n-d*65536,n=J+d+65535,d=Math.floor(n/65536),J=n-d*65536,n=X+d+65535,d=Math.floor(n/65536),X=n-d*65536,n=N+d+65535,d=Math.floor(n/65536),N=n-d*65536,n=A+d+65535,d=Math.floor(n/65536),A=n-d*65536,n=k+d+65535,d=Math.floor(n/65536),k=n-d*65536,n=z+d+65535,d=Math.floor(n/65536),z=n-d*65536,n=U+d+65535,d=Math.floor(n/65536),U=n-d*65536,n=M+d+65535,d=Math.floor(n/65536),M=n-d*65536,n=$+d+65535,d=Math.floor(n/65536),$=n-d*65536,n=B+d+65535,d=Math.floor(n/65536),B=n-d*65536,n=ie+d+65535,d=Math.floor(n/65536),ie=n-d*65536,n=H+d+65535,d=Math.floor(n/65536),H=n-d*65536,n=Z+d+65535,d=Math.floor(n/65536),Z=n-d*65536,F+=d-1+37*(d-1),d=1,n=F+d+65535,d=Math.floor(n/65536),F=n-d*65536,n=j+d+65535,d=Math.floor(n/65536),j=n-d*65536,n=Y+d+65535,d=Math.floor(n/65536),Y=n-d*65536,n=J+d+65535,d=Math.floor(n/65536),J=n-d*65536,n=X+d+65535,d=Math.floor(n/65536),X=n-d*65536,n=N+d+65535,d=Math.floor(n/65536),N=n-d*65536,n=A+d+65535,d=Math.floor(n/65536),A=n-d*65536,n=k+d+65535,d=Math.floor(n/65536),k=n-d*65536,n=z+d+65535,d=Math.floor(n/65536),z=n-d*65536,n=U+d+65535,d=Math.floor(n/65536),U=n-d*65536,n=M+d+65535,d=Math.floor(n/65536),M=n-d*65536,n=$+d+65535,d=Math.floor(n/65536),$=n-d*65536,n=B+d+65535,d=Math.floor(n/65536),B=n-d*65536,n=ie+d+65535,d=Math.floor(n/65536),ie=n-d*65536,n=H+d+65535,d=Math.floor(n/65536),H=n-d*65536,n=Z+d+65535,d=Math.floor(n/65536),Z=n-d*65536,F+=d-1+37*(d-1),f[0]=F,f[1]=j,f[2]=Y,f[3]=J,f[4]=X,f[5]=N,f[6]=A,f[7]=k,f[8]=z,f[9]=U,f[10]=M,f[11]=$,f[12]=B,f[13]=ie,f[14]=H,f[15]=Z}function v(f,g){C(f,g,g)}function D(f,g){const p=i();for(let n=0;n<16;n++)p[n]=g[n];for(let n=253;n>=0;n--)v(p,p),n!==2&&n!==4&&C(p,p,g);for(let n=0;n<16;n++)f[n]=p[n]}function P(f,g){const p=new Uint8Array(32),n=new Float64Array(80),d=i(),F=i(),j=i(),Y=i(),J=i(),X=i();for(let z=0;z<31;z++)p[z]=f[z];p[31]=f[31]&127|64,p[0]&=248,w(n,g);for(let z=0;z<16;z++)F[z]=n[z];d[0]=Y[0]=1;for(let z=254;z>=0;--z){const U=p[z>>>3]>>>(z&7)&1;a(d,F,U),a(j,Y,U),_(J,d,j),E(d,d,j),_(j,F,Y),E(F,F,Y),v(Y,J),v(X,d),C(d,j,d),C(j,F,J),_(J,d,j),E(d,d,j),v(F,d),E(j,Y,X),C(d,j,c),_(d,d,Y),C(j,j,d),C(d,Y,X),C(Y,F,n),v(F,J),a(d,F,U),a(j,Y,U)}for(let z=0;z<16;z++)n[z+16]=d[z],n[z+32]=j[z],n[z+48]=F[z],n[z+64]=Y[z];const N=n.subarray(32),A=n.subarray(16);D(N,N),C(A,A,N);const k=new Uint8Array(32);return h(k,A),k}t.scalarMult=P;function T(f){return P(f,s)}t.scalarMultBase=T;function L(f){if(f.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const g=new Uint8Array(f);return{publicKey:T(g),secretKey:g}}t.generateKeyPairFromSeed=L;function l(f){const g=(0,e.randomBytes)(32,f),p=L(g);return(0,r.wipe)(g),p}t.generateKeyPair=l;function b(f,g,p=!1){if(f.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(g.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=P(f,g);if(p){let d=0;for(let F=0;F<n.length;F++)d|=n[F];if(d===0)throw new Error("X25519: invalid shared key")}return n}t.sharedKey=b})(qi);var Hs=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,c;i<s;i++)(c||!(i in e))&&(c||(c=Array.prototype.slice.call(e,0,i)),c[i]=e[i]);return t.concat(c||Array.prototype.slice.call(e))},Au=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),Nu=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Cu=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),Pu=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Fu=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Ru=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Uu=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,qs=3,Lu=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Ru]],Ks=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Mu(t){return t?Vs(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Fu:typeof navigator<"u"?Vs(navigator.userAgent):zu()}function $u(t){return t!==""&&Lu.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var c=s.exec(t);return!!c&&[i,c]},!1)}function Vs(t){var e=$u(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Pu;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<qs&&(s=Hs(Hs([],s,!0),Bu(qs-s.length),!0)):s=[];var c=s.join("."),u=ju(t),a=Uu.exec(t);return a&&a[1]?new Cu(r,c,u,a[1]):new Au(r,c,u)}function ju(t){for(var e=0,r=Ks.length;e<r;e++){var i=Ks[e],s=i[0],c=i[1],u=c.exec(t);if(u)return s}return null}function zu(){var t=typeof process<"u"&&process.version;return t?new Nu(process.version.slice(1)):null}function Bu(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.getLocalStorage=xe.getLocalStorageOrThrow=xe.getCrypto=xe.getCryptoOrThrow=yo=xe.getLocation=xe.getLocationOrThrow=Ki=xe.getNavigator=xe.getNavigatorOrThrow=po=xe.getDocument=xe.getDocumentOrThrow=xe.getFromWindowOrThrow=xe.getFromWindow=void 0;function Xt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}xe.getFromWindow=Xt;function or(t){const e=Xt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}xe.getFromWindowOrThrow=or;function Hu(){return or("document")}xe.getDocumentOrThrow=Hu;function qu(){return Xt("document")}var po=xe.getDocument=qu;function Ku(){return or("navigator")}xe.getNavigatorOrThrow=Ku;function Vu(){return Xt("navigator")}var Ki=xe.getNavigator=Vu;function Gu(){return or("location")}xe.getLocationOrThrow=Gu;function ku(){return Xt("location")}var yo=xe.getLocation=ku;function Wu(){return or("crypto")}xe.getCryptoOrThrow=Wu;function Yu(){return Xt("crypto")}xe.getCrypto=Yu;function Ju(){return or("localStorage")}xe.getLocalStorageOrThrow=Ju;function Xu(){return Xt("localStorage")}xe.getLocalStorage=Xu;var Vi={};Object.defineProperty(Vi,"__esModule",{value:!0});var bo=Vi.getWindowMetadata=void 0;const Gs=xe;function Zu(){let t,e;try{t=Gs.getDocumentOrThrow(),e=Gs.getLocationOrThrow()}catch{return null}function r(){const E=t.getElementsByTagName("link"),C=[];for(let v=0;v<E.length;v++){const D=E[v],P=D.getAttribute("rel");if(P&&P.toLowerCase().indexOf("icon")>-1){const T=D.getAttribute("href");if(T)if(T.toLowerCase().indexOf("https:")===-1&&T.toLowerCase().indexOf("http:")===-1&&T.indexOf("//")!==0){let L=e.protocol+"//"+e.host;if(T.indexOf("/")===0)L+=T;else{const l=e.pathname.split("/");l.pop();const b=l.join("/");L+=b+"/"+T}C.push(L)}else if(T.indexOf("//")===0){const L=e.protocol+T;C.push(L)}else C.push(T)}}return C}function i(...E){const C=t.getElementsByTagName("meta");for(let v=0;v<C.length;v++){const D=C[v],P=["itemprop","property","name"].map(T=>D.getAttribute(T)).filter(T=>T?E.includes(T):!1);if(P.length&&P){const T=D.getAttribute("content");if(T)return T}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=t.title),E}function c(){return i("description","og:description","twitter:description","keywords")}const u=s(),a=c(),h=e.origin,w=r();return{description:a,url:h,icons:w,name:u}}bo=Vi.getWindowMetadata=Zu;var vr={},_o=function(t,e){for(var r={},i=Object.keys(t),s=Array.isArray(e),c=0;c<i.length;c++){var u=i[c],a=t[u];(s?e.indexOf(u)!==-1:e(u,a,t))&&(r[u]=a)}return r};(function(t){const e=Ln,r=Mn,i=Un,s=_o,c=l=>l==null,u=Symbol("encodeFragmentIdentifier");function a(l){switch(l.arrayFormat){case"index":return b=>(f,g)=>{const p=f.length;return g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[_(b,l),"[",p,"]"].join("")]:[...f,[_(b,l),"[",_(p,l),"]=",_(g,l)].join("")]};case"bracket":return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[_(b,l),"[]"].join("")]:[...f,[_(b,l),"[]=",_(g,l)].join("")];case"colon-list-separator":return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[_(b,l),":list="].join("")]:[...f,[_(b,l),":list=",_(g,l)].join("")];case"comma":case"separator":case"bracket-separator":{const b=l.arrayFormat==="bracket-separator"?"[]=":"=";return f=>(g,p)=>p===void 0||l.skipNull&&p===null||l.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[_(f,l),b,_(p,l)].join("")]:[[g,_(p,l)].join(l.arrayFormatSeparator)])}default:return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,_(b,l)]:[...f,[_(b,l),"=",_(g,l)].join("")]}}function h(l){let b;switch(l.arrayFormat){case"index":return(f,g,p)=>{if(b=/\[(\d*)\]$/.exec(f),f=f.replace(/\[\d*\]$/,""),!b){p[f]=g;return}p[f]===void 0&&(p[f]={}),p[f][b[1]]=g};case"bracket":return(f,g,p)=>{if(b=/(\[\])$/.exec(f),f=f.replace(/\[\]$/,""),!b){p[f]=g;return}if(p[f]===void 0){p[f]=[g];return}p[f]=[].concat(p[f],g)};case"colon-list-separator":return(f,g,p)=>{if(b=/(:list)$/.exec(f),f=f.replace(/:list$/,""),!b){p[f]=g;return}if(p[f]===void 0){p[f]=[g];return}p[f]=[].concat(p[f],g)};case"comma":case"separator":return(f,g,p)=>{const n=typeof g=="string"&&g.includes(l.arrayFormatSeparator),d=typeof g=="string"&&!n&&E(g,l).includes(l.arrayFormatSeparator);g=d?E(g,l):g;const F=n||d?g.split(l.arrayFormatSeparator).map(j=>E(j,l)):g===null?g:E(g,l);p[f]=F};case"bracket-separator":return(f,g,p)=>{const n=/(\[\])$/.test(f);if(f=f.replace(/\[\]$/,""),!n){p[f]=g&&E(g,l);return}const d=g===null?[]:g.split(l.arrayFormatSeparator).map(F=>E(F,l));if(p[f]===void 0){p[f]=d;return}p[f]=[].concat(p[f],d)};default:return(f,g,p)=>{if(p[f]===void 0){p[f]=g;return}p[f]=[].concat(p[f],g)}}}function w(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function _(l,b){return b.encode?b.strict?e(l):encodeURIComponent(l):l}function E(l,b){return b.decode?r(l):l}function C(l){return Array.isArray(l)?l.sort():typeof l=="object"?C(Object.keys(l)).sort((b,f)=>Number(b)-Number(f)).map(b=>l[b]):l}function v(l){const b=l.indexOf("#");return b!==-1&&(l=l.slice(0,b)),l}function D(l){let b="";const f=l.indexOf("#");return f!==-1&&(b=l.slice(f)),b}function P(l){l=v(l);const b=l.indexOf("?");return b===-1?"":l.slice(b+1)}function T(l,b){return b.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):b.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function L(l,b){b=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},b),w(b.arrayFormatSeparator);const f=h(b),g=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return g;for(const p of l.split("&")){if(p==="")continue;let[n,d]=i(b.decode?p.replace(/\+/g," "):p,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(b.arrayFormat)?d:E(d,b),f(E(n,b),d,g)}for(const p of Object.keys(g)){const n=g[p];if(typeof n=="object"&&n!==null)for(const d of Object.keys(n))n[d]=T(n[d],b);else g[p]=T(n,b)}return b.sort===!1?g:(b.sort===!0?Object.keys(g).sort():Object.keys(g).sort(b.sort)).reduce((p,n)=>{const d=g[n];return Boolean(d)&&typeof d=="object"&&!Array.isArray(d)?p[n]=C(d):p[n]=d,p},Object.create(null))}t.extract=P,t.parse=L,t.stringify=(l,b)=>{if(!l)return"";b=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},b),w(b.arrayFormatSeparator);const f=d=>b.skipNull&&c(l[d])||b.skipEmptyString&&l[d]==="",g=a(b),p={};for(const d of Object.keys(l))f(d)||(p[d]=l[d]);const n=Object.keys(p);return b.sort!==!1&&n.sort(b.sort),n.map(d=>{const F=l[d];return F===void 0?"":F===null?_(d,b):Array.isArray(F)?F.length===0&&b.arrayFormat==="bracket-separator"?_(d,b)+"[]":F.reduce(g(d),[]).join("&"):_(d,b)+"="+_(F,b)}).filter(d=>d.length>0).join("&")},t.parseUrl=(l,b)=>{b=Object.assign({decode:!0},b);const[f,g]=i(l,"#");return Object.assign({url:f.split("?")[0]||"",query:L(P(l),b)},b&&b.parseFragmentIdentifier&&g?{fragmentIdentifier:E(g,b)}:{})},t.stringifyUrl=(l,b)=>{b=Object.assign({encode:!0,strict:!0,[u]:!0},b);const f=v(l.url).split("?")[0]||"",g=t.extract(l.url),p=t.parse(g,{sort:!1}),n=Object.assign(p,l.query);let d=t.stringify(n,b);d&&(d=`?${d}`);let F=D(l.url);return l.fragmentIdentifier&&(F=`#${b[u]?_(l.fragmentIdentifier,b):l.fragmentIdentifier}`),`${f}${d}${F}`},t.pick=(l,b,f)=>{f=Object.assign({parseFragmentIdentifier:!0,[u]:!1},f);const{url:g,query:p,fragmentIdentifier:n}=t.parseUrl(l,f);return t.stringifyUrl({url:g,query:s(p,b),fragmentIdentifier:n},f)},t.exclude=(l,b,f)=>{const g=Array.isArray(b)?p=>!b.includes(p):(p,n)=>!b(p,n);return t.pick(l,g,f)}})(vr);const Qu={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},wo="base10",ct="base16",Ii="base64pad",Gi="utf8",mo=0,Zt=1,el=0,ks=1,Oi=12,ki=32;function tl(){const t=qi.generateKeyPair();return{privateKey:ht(t.secretKey,ct),publicKey:ht(t.publicKey,ct)}}function Ti(){const t=nr.randomBytes(ki);return ht(t,ct)}function rl(t,e){const r=qi.sharedKey(at(t,ct),at(e,ct)),i=new Tu(ti.SHA256,r).expand(ki);return ht(i,ct)}function il(t){const e=ti.hash(at(t,ct));return ht(e,ct)}function Ai(t){const e=ti.hash(at(t,Gi));return ht(e,ct)}function sl(t){return at(`${t}`,wo)}function Tr(t){return Number(ht(t,wo))}function nl(t){const e=sl(typeof t.type<"u"?t.type:mo);if(Tr(e)===Zt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?at(t.senderPublicKey,ct):void 0,i=typeof t.iv<"u"?at(t.iv,ct):nr.randomBytes(Oi),s=new Bi.ChaCha20Poly1305(at(t.symKey,ct)).seal(i,at(t.message,Gi));return al({type:e,sealed:s,iv:i,senderPublicKey:r})}function ol(t){const e=new Bi.ChaCha20Poly1305(at(t.symKey,ct)),{sealed:r,iv:i}=Wi(t.encoded),s=e.open(i,r);if(s===null)throw new Error("Failed to decrypt");return ht(s,Gi)}function al(t){if(Tr(t.type)===Zt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ht(Si([t.type,t.senderPublicKey,t.iv,t.sealed]),Ii)}return ht(Si([t.type,t.iv,t.sealed]),Ii)}function Wi(t){const e=at(t,Ii),r=e.slice(el,ks),i=ks;if(Tr(r)===Zt){const a=i+ki,h=a+Oi,w=e.slice(i,a),_=e.slice(a,h),E=e.slice(h);return{type:r,sealed:E,iv:_,senderPublicKey:w}}const s=i+Oi,c=e.slice(i,s),u=e.slice(s);return{type:r,sealed:u,iv:c}}function cl(t,e){const r=Wi(t);return Eo({type:Tr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ht(r.senderPublicKey,ct):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Eo(t){const e=(t==null?void 0:t.type)||mo;if(e===Zt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Ws(t){return t.type===Zt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var hl=Object.defineProperty,Ys=Object.getOwnPropertySymbols,ul=Object.prototype.hasOwnProperty,ll=Object.prototype.propertyIsEnumerable,Js=(t,e,r)=>e in t?hl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xs=(t,e)=>{for(var r in e||(e={}))ul.call(e,r)&&Js(t,r,e[r]);if(Ys)for(var r of Ys(e))ll.call(e,r)&&Js(t,r,e[r]);return t};const fl="ReactNative",wr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},dl="js";function vo(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function gl(){return!po()&&!!Ki()&&navigator.product===fl}function pl(){return!vo()&&!!Ki()}function yl(){return gl()?wr.reactNative:vo()?wr.node:pl()?wr.browser:wr.unknown}function bl(t,e){let r=vr.parse(t);return r=Xs(Xs({},r),e),t=vr.stringify(r),t}function _l(){return bo()||{name:"",description:"",url:"",icons:[""]}}function wl(){const t=Mu();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function ml(){var t;const e=yl();return e===wr.browser?[e,((t=yo())==null?void 0:t.host)||"unknown"].join(":"):e}function El(t,e,r){const i=wl(),s=ml();return[[t,e].join("-"),[dl,r].join("-"),i,s].join("/")}function vl({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:c}){const u=r.split("?"),a=El(t,e,i),h={auth:s,ua:a,projectId:c},w=bl(u[1]||"",h);return u[0]+"?"+w}function ot(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Do(t){return Object.fromEntries(t.entries())}function So(t){return new Map(Object.entries(t))}function Nt(t,e){return Q.fromMiliseconds((e||Date.now())+Q.toMiliseconds(t))}function Mt(t){return Q.fromMiliseconds(Date.now())>=Q.toMiliseconds(t)}function Wt(){const t=Q.toMiliseconds(Q.FIVE_MINUTES);let e,r,i;return{resolve:s=>{i&&e&&(clearTimeout(i),e(s))},reject:s=>{i&&r&&(clearTimeout(i),r(s))},done:()=>new Promise((s,c)=>{i=setTimeout(c,t),e=s,r=c})}}function xo(t,e){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(),e),c=await t;clearTimeout(s),r(c)})}function Io(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Dl(t){return Io("topic",t)}function Sl(t){return Io("id",t)}function Oo(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Ue(t,e){return`${t}${e?`:${e}`:""}`}const xl="irn";function Ni(t){return(t==null?void 0:t.relay)||{protocol:xl}}function Ci(t){const e=Qu[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Il=Object.defineProperty,Zs=Object.getOwnPropertySymbols,Ol=Object.prototype.hasOwnProperty,Tl=Object.prototype.propertyIsEnumerable,Qs=(t,e,r)=>e in t?Il(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Al=(t,e)=>{for(var r in e||(e={}))Ol.call(e,r)&&Qs(t,r,e[r]);if(Zs)for(var r of Zs(e))Tl.call(e,r)&&Qs(t,r,e[r]);return t};function Nl(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const c=s.replace(i,""),u=t[s];r[c]=u}}),r}function Cl(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),c=typeof r<"u"?t.substring(r):"",u=vr.parse(c);return{protocol:i,topic:s[0],version:parseInt(s[1],10),symKey:u.symKey,relay:Nl(u)}}function Pl(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const c=r+e+s;t[s]&&(i[c]=t[s])}),i}function Fl(t){return`${t.protocol}:${t.topic}@${t.version}?`+vr.stringify(Al({symKey:t.symKey},Pl(t.relay)))}function It(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function Rl(t){const e=[];return Object.values(t).forEach(r=>{e.push(...It(r.accounts)),r.extension&&r.extension.forEach(i=>{e.push(...It(i.accounts))})}),e}function Ul(t,e){const r=[];return Object.values(t).forEach(i=>{It(i.accounts).includes(e)&&r.push(...i.methods),i.extension&&i.extension.forEach(s=>{It(s.accounts).includes(e)&&r.push(...s.methods)})}),r}function Ll(t,e){const r=[];return Object.values(t).forEach(i=>{It(i.accounts).includes(e)&&r.push(...i.events),i.extension&&i.extension.forEach(s=>{It(s.accounts).includes(e)&&r.push(...s.events)})}),r}const Ml={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},$l={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function K(t,e){const{message:r,code:i}=$l[t];return{message:e?`${r} ${e}`:r,code:i}}function Je(t,e){const{message:r,code:i}=Ml[t];return{message:e?`${r} ${e}`:r,code:i}}function Ar(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function To(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function yt(t){return typeof t>"u"}function Ze(t,e){return e&&yt(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function Ao(t,e){return e&&yt(t)?!0:typeof t=="number"&&!isNaN(t)}function jl(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let c=!0;return ot(s,i)?(i.forEach(u=>{const{accounts:a,methods:h,events:w,extension:_}=t.namespaces[u],E=It(a),C=r[u];(!ot(C.chains,E)||!ot(C.methods,h)||!ot(C.events,w))&&(c=!1),c&&_&&_.forEach(v=>{var D;const{accounts:P,methods:T,events:L}=v,l=It(P);(D=C.extension)!=null&&D.find(b=>ot(b.chains,l)&&ot(b.methods,T)&&ot(b.events,L))||(c=!1)})}),c):!1}function Yi(t){return Ze(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function zl(t){if(Ze(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Yi(r)}}return!1}function Bl(t){if(Ze(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Hl(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function ql(t){return t==null?void 0:t.topic}function Kl(t,e){let r=null;return Ze(t==null?void 0:t.publicKey,!1)||(r=K("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Ji(t,e){let r=null;return yt(t==null?void 0:t.extension)||(!Ar(t.extension)||!t.extension.length)&&(r=K("MISSING_OR_INVALID",`${e} extension should be an array of namespaces, or omitted`)),r}function en(t){let e=!0;return Ar(t)?t.length&&(e=t.every(r=>Ze(r,!1))):e=!1,e}function tn(t,e,r){let i=null;return Ar(e)?e.forEach(s=>{i||(!Yi(s)||!s.includes(t))&&(i=Je("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):i=Je("UNSUPPORTED_CHAINS",`${r}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function Vl(t,e){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;const c=tn(i,s==null?void 0:s.chains,`${e} requiredNamespace`),u=Ji(s,e);c?r=c:u?r=u:s.extension&&s.extension.forEach(a=>{if(r)return;const h=tn(i,a.chains,`${e} extension`);h&&(r=h)})}),r}function rn(t,e){let r=null;return Ar(t)?t.forEach(i=>{r||zl(i)||(r=Je("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=Je("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Gl(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=rn(i==null?void 0:i.accounts,`${e} namespace`),c=Ji(i,e);s?r=s:c?r=c:i.extension&&i.extension.forEach(u=>{if(r)return;const a=rn(u.accounts,`${e} extension`);a&&(r=a)})}),r}function sn(t,e){let r=null;return en(t==null?void 0:t.methods)?en(t==null?void 0:t.events)||(r=Je("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Je("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function No(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=sn(i,`${e}, namespace`),c=Ji(i,e);s?r=s:c?r=c:i.extension&&i.extension.forEach(u=>{if(r)return;const a=sn(u,`${e}, extension`);a&&(r=a)})}),r}function kl(t,e){let r=null;if(t&&To(t)){const i=No(t,e);i&&(r=i);const s=Vl(t,e);s&&(r=s)}else r=K("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return r}function pi(t,e){let r=null;if(t&&To(t)){const i=No(t,e);i&&(r=i);const s=Gl(t,e);s&&(r=s)}else r=K("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Co(t){return Ze(t.protocol,!0)}function Wl(t,e){let r=!1;return e&&!t?r=!0:t&&Ar(t)&&t.length&&t.forEach(i=>{r=Co(i)}),r}function Yl(t){return typeof t=="number"}function st(t){return typeof t<"u"&&typeof t!==null}function Jl(t){return!(!t||typeof t!="object"||!t.code||!Ao(t.code,!1)||!t.message||!Ze(t.message,!1))}function Xl(t){return!(yt(t)||!Ze(t.method,!1))}function Zl(t){return!(yt(t)||yt(t.result)&&yt(t.error)||!Ao(t.id,!1)||!Ze(t.jsonrpc,!1))}function Ql(t){return!(yt(t)||!Ze(t.name,!1))}function nn(t,e){return!(!Yi(e)||!Rl(t).includes(e))}function ef(t,e,r){return Ze(r,!1)?Ul(t,e).includes(r):!1}function tf(t,e,r){return Ze(r,!1)?Ll(t,e).includes(r):!1}function on(t,e,r){let i=null;const s=Object.keys(t),c=Object.keys(e);return ot(s,c)?s.forEach(u=>{var a;if(i)return;const h=t[u].chains,w=It(e[u].accounts);ot(h,w)?ot(t[u].methods,e[u].methods)?ot(t[u].events,e[u].events)?t[u].extension&&!e[u].extension?i=K("NON_CONFORMING_NAMESPACES",`${r} namespaces extension doesn't satisfy requiredNamespaces extension for ${u}`):t[u].extension&&e[u].extension&&((a=t[u].extension)==null||a.forEach(({methods:_,events:E,chains:C})=>{var v;i||(v=e[u].extension)!=null&&v.find(D=>{const P=It(D.accounts);return ot(C,P)&&ot(E,D.events)&&ot(_,D.methods)})||(i=K("NON_CONFORMING_NAMESPACES",`${r} namespaces extension doesn't satisfy requiredNamespaces extension for ${u}`))})):i=K("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy requiredNamespaces events for ${u}`):i=K("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy requiredNamespaces methods for ${u}`):i=K("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy requiredNamespaces chains for ${u}`)}):i=K("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces`),i}const an=10,rf=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),sf=()=>typeof window<"u",nf=rf();class of{constructor(e){if(this.url=e,this.events=new bt.EventEmitter,this.registering=!1,!fs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(typeof this.socket>"u")throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ri(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!fs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=Ma.isReactNative()?void 0:{rejectUnauthorized:!$a(e)},c=new nf(e,[],s);sf()?c.onerror=u=>{const a=u;i(this.emitError(a.error))}:c.on("error",u=>{i(this.emitError(u))}),c.onopen=()=>{this.onOpen(c),r(c)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?$n(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),c=Ui(e,s);this.events.emit("payload",c)}parseError(e,r=this.url){return ja(e,r,"WS")}resetMaxListeners(){this.events.getMaxListeners()>an&&this.events.setMaxListeners(an)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",r),r}}var Gr={},af={get exports(){return Gr},set exports(t){Gr=t}};(function(t,e){var r=200,i="__lodash_hash_undefined__",s=1,c=2,u=9007199254740991,a="[object Arguments]",h="[object Array]",w="[object AsyncFunction]",_="[object Boolean]",E="[object Date]",C="[object Error]",v="[object Function]",D="[object GeneratorFunction]",P="[object Map]",T="[object Number]",L="[object Null]",l="[object Object]",b="[object Promise]",f="[object Proxy]",g="[object RegExp]",p="[object Set]",n="[object String]",d="[object Symbol]",F="[object Undefined]",j="[object WeakMap]",Y="[object ArrayBuffer]",J="[object DataView]",X="[object Float32Array]",N="[object Float64Array]",A="[object Int8Array]",k="[object Int16Array]",z="[object Int32Array]",U="[object Uint8Array]",M="[object Uint8ClampedArray]",$="[object Uint16Array]",B="[object Uint32Array]",ie=/[\\^$.*+?()[\]{}|]/g,H=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,W={};W[X]=W[N]=W[A]=W[k]=W[z]=W[U]=W[M]=W[$]=W[B]=!0,W[a]=W[h]=W[Y]=W[_]=W[J]=W[E]=W[C]=W[v]=W[P]=W[T]=W[l]=W[g]=W[p]=W[n]=W[j]=!1;var ae=typeof Yt=="object"&&Yt&&Yt.Object===Object&&Yt,O=typeof self=="object"&&self&&self.Object===Object&&self,I=ae||O||Function("return this")(),S=e&&!e.nodeType&&e,o=S&&!0&&t&&!t.nodeType&&t,m=o&&o.exports===S,q=m&&ae.process,V=function(){try{return q&&q.binding&&q.binding("util")}catch{}}(),le=V&&V.isTypedArray;function be(y,x){for(var R=-1,G=y==null?0:y.length,Oe=0,se=[];++R<G;){var Fe=y[R];x(Fe,R,y)&&(se[Oe++]=Fe)}return se}function de(y,x){for(var R=-1,G=x.length,Oe=y.length;++R<G;)y[Oe+R]=x[R];return y}function me(y,x){for(var R=-1,G=y==null?0:y.length;++R<G;)if(x(y[R],R,y))return!0;return!1}function Re(y,x){for(var R=-1,G=Array(y);++R<y;)G[R]=x(R);return G}function Ne(y){return function(x){return y(x)}}function ye(y,x){return y.has(x)}function ge(y,x){return y==null?void 0:y[x]}function fe(y){var x=-1,R=Array(y.size);return y.forEach(function(G,Oe){R[++x]=[Oe,G]}),R}function he(y,x){return function(R){return y(x(R))}}function ce(y){var x=-1,R=Array(y.size);return y.forEach(function(G){R[++x]=G}),R}var oe=Array.prototype,ne=Function.prototype,ee=Object.prototype,ue=I["__core-js_shared__"],pe=ne.toString,te=ee.hasOwnProperty,_e=function(){var y=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),we=ee.toString,ve=RegExp("^"+pe.call(te).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=m?I.Buffer:void 0,Ee=I.Symbol,_t=I.Uint8Array,Et=ee.propertyIsEnumerable,Ct=oe.splice,ut=Ee?Ee.toStringTag:void 0,zt=Object.getOwnPropertySymbols,cr=De?De.isBuffer:void 0,Cr=he(Object.keys,Object),Le=er(I,"DataView"),Ce=er(I,"Map"),Me=er(I,"Promise"),$e=er(I,"Set"),je=er(I,"WeakMap"),Pe=er(Object,"create"),He=Ht(Le),qe=Ht(Ce),Ke=Ht(Me),Ve=Ht($e),Ge=Ht(je),Be=Ee?Ee.prototype:void 0,ze=Be?Be.valueOf:void 0;function Te(y){var x=-1,R=y==null?0:y.length;for(this.clear();++x<R;){var G=y[x];this.set(G[0],G[1])}}function ke(){this.__data__=Pe?Pe(null):{},this.size=0}function We(y){var x=this.has(y)&&delete this.__data__[y];return this.size-=x?1:0,x}function Wo(y){var x=this.__data__;if(Pe){var R=x[y];return R===i?void 0:R}return te.call(x,y)?x[y]:void 0}function Yo(y){var x=this.__data__;return Pe?x[y]!==void 0:te.call(x,y)}function Jo(y,x){var R=this.__data__;return this.size+=this.has(y)?0:1,R[y]=Pe&&x===void 0?i:x,this}Te.prototype.clear=ke,Te.prototype.delete=We,Te.prototype.get=Wo,Te.prototype.has=Yo,Te.prototype.set=Jo;function Ot(y){var x=-1,R=y==null?0:y.length;for(this.clear();++x<R;){var G=y[x];this.set(G[0],G[1])}}function Xo(){this.__data__=[],this.size=0}function Zo(y){var x=this.__data__,R=Fr(x,y);if(R<0)return!1;var G=x.length-1;return R==G?x.pop():Ct.call(x,R,1),--this.size,!0}function Qo(y){var x=this.__data__,R=Fr(x,y);return R<0?void 0:x[R][1]}function ea(y){return Fr(this.__data__,y)>-1}function ta(y,x){var R=this.__data__,G=Fr(R,y);return G<0?(++this.size,R.push([y,x])):R[G][1]=x,this}Ot.prototype.clear=Xo,Ot.prototype.delete=Zo,Ot.prototype.get=Qo,Ot.prototype.has=ea,Ot.prototype.set=ta;function Bt(y){var x=-1,R=y==null?0:y.length;for(this.clear();++x<R;){var G=y[x];this.set(G[0],G[1])}}function ra(){this.size=0,this.__data__={hash:new Te,map:new(Ce||Ot),string:new Te}}function ia(y){var x=Rr(this,y).delete(y);return this.size-=x?1:0,x}function sa(y){return Rr(this,y).get(y)}function na(y){return Rr(this,y).has(y)}function oa(y,x){var R=Rr(this,y),G=R.size;return R.set(y,x),this.size+=R.size==G?0:1,this}Bt.prototype.clear=ra,Bt.prototype.delete=ia,Bt.prototype.get=sa,Bt.prototype.has=na,Bt.prototype.set=oa;function Pr(y){var x=-1,R=y==null?0:y.length;for(this.__data__=new Bt;++x<R;)this.add(y[x])}function aa(y){return this.__data__.set(y,i),this}function ca(y){return this.__data__.has(y)}Pr.prototype.add=Pr.prototype.push=aa,Pr.prototype.has=ca;function Pt(y){var x=this.__data__=new Ot(y);this.size=x.size}function ha(){this.__data__=new Ot,this.size=0}function ua(y){var x=this.__data__,R=x.delete(y);return this.size=x.size,R}function la(y){return this.__data__.get(y)}function fa(y){return this.__data__.has(y)}function da(y,x){var R=this.__data__;if(R instanceof Ot){var G=R.__data__;if(!Ce||G.length<r-1)return G.push([y,x]),this.size=++R.size,this;R=this.__data__=new Bt(G)}return R.set(y,x),this.size=R.size,this}Pt.prototype.clear=ha,Pt.prototype.delete=ua,Pt.prototype.get=la,Pt.prototype.has=fa,Pt.prototype.set=da;function ga(y,x){var R=Ur(y),G=!R&&Aa(y),Oe=!R&&!G&&si(y),se=!R&&!G&&!Oe&&us(y),Fe=R||G||Oe||se,Ye=Fe?Re(y.length,String):[],Xe=Ye.length;for(var Ae in y)(x||te.call(y,Ae))&&!(Fe&&(Ae=="length"||Oe&&(Ae=="offset"||Ae=="parent")||se&&(Ae=="buffer"||Ae=="byteLength"||Ae=="byteOffset")||Sa(Ae,Xe)))&&Ye.push(Ae);return Ye}function Fr(y,x){for(var R=y.length;R--;)if(os(y[R][0],x))return R;return-1}function pa(y,x,R){var G=x(y);return Ur(y)?G:de(G,R(y))}function hr(y){return y==null?y===void 0?F:L:ut&&ut in Object(y)?va(y):Ta(y)}function rs(y){return ur(y)&&hr(y)==a}function is(y,x,R,G,Oe){return y===x?!0:y==null||x==null||!ur(y)&&!ur(x)?y!==y&&x!==x:ya(y,x,R,G,is,Oe)}function ya(y,x,R,G,Oe,se){var Fe=Ur(y),Ye=Ur(x),Xe=Fe?h:Ft(y),Ae=Ye?h:Ft(x);Xe=Xe==a?l:Xe,Ae=Ae==a?l:Ae;var lt=Xe==l,wt=Ae==l,tt=Xe==Ae;if(tt&&si(y)){if(!si(x))return!1;Fe=!0,lt=!1}if(tt&&!lt)return se||(se=new Pt),Fe||us(y)?ss(y,x,R,G,Oe,se):ma(y,x,Xe,R,G,Oe,se);if(!(R&s)){var dt=lt&&te.call(y,"__wrapped__"),gt=wt&&te.call(x,"__wrapped__");if(dt||gt){var Rt=dt?y.value():y,Tt=gt?x.value():x;return se||(se=new Pt),Oe(Rt,Tt,R,G,se)}}return tt?(se||(se=new Pt),Ea(y,x,R,G,Oe,se)):!1}function ba(y){if(!hs(y)||Ia(y))return!1;var x=as(y)?ve:H;return x.test(Ht(y))}function _a(y){return ur(y)&&cs(y.length)&&!!W[hr(y)]}function wa(y){if(!Oa(y))return Cr(y);var x=[];for(var R in Object(y))te.call(y,R)&&R!="constructor"&&x.push(R);return x}function ss(y,x,R,G,Oe,se){var Fe=R&s,Ye=y.length,Xe=x.length;if(Ye!=Xe&&!(Fe&&Xe>Ye))return!1;var Ae=se.get(y);if(Ae&&se.get(x))return Ae==x;var lt=-1,wt=!0,tt=R&c?new Pr:void 0;for(se.set(y,x),se.set(x,y);++lt<Ye;){var dt=y[lt],gt=x[lt];if(G)var Rt=Fe?G(gt,dt,lt,x,y,se):G(dt,gt,lt,y,x,se);if(Rt!==void 0){if(Rt)continue;wt=!1;break}if(tt){if(!me(x,function(Tt,qt){if(!ye(tt,qt)&&(dt===Tt||Oe(dt,Tt,R,G,se)))return tt.push(qt)})){wt=!1;break}}else if(!(dt===gt||Oe(dt,gt,R,G,se))){wt=!1;break}}return se.delete(y),se.delete(x),wt}function ma(y,x,R,G,Oe,se,Fe){switch(R){case J:if(y.byteLength!=x.byteLength||y.byteOffset!=x.byteOffset)return!1;y=y.buffer,x=x.buffer;case Y:return!(y.byteLength!=x.byteLength||!se(new _t(y),new _t(x)));case _:case E:case T:return os(+y,+x);case C:return y.name==x.name&&y.message==x.message;case g:case n:return y==x+"";case P:var Ye=fe;case p:var Xe=G&s;if(Ye||(Ye=ce),y.size!=x.size&&!Xe)return!1;var Ae=Fe.get(y);if(Ae)return Ae==x;G|=c,Fe.set(y,x);var lt=ss(Ye(y),Ye(x),G,Oe,se,Fe);return Fe.delete(y),lt;case d:if(ze)return ze.call(y)==ze.call(x)}return!1}function Ea(y,x,R,G,Oe,se){var Fe=R&s,Ye=ns(y),Xe=Ye.length,Ae=ns(x),lt=Ae.length;if(Xe!=lt&&!Fe)return!1;for(var wt=Xe;wt--;){var tt=Ye[wt];if(!(Fe?tt in x:te.call(x,tt)))return!1}var dt=se.get(y);if(dt&&se.get(x))return dt==x;var gt=!0;se.set(y,x),se.set(x,y);for(var Rt=Fe;++wt<Xe;){tt=Ye[wt];var Tt=y[tt],qt=x[tt];if(G)var ls=Fe?G(qt,Tt,tt,x,y,se):G(Tt,qt,tt,y,x,se);if(!(ls===void 0?Tt===qt||Oe(Tt,qt,R,G,se):ls)){gt=!1;break}Rt||(Rt=tt=="constructor")}if(gt&&!Rt){var Lr=y.constructor,Mr=x.constructor;Lr!=Mr&&"constructor"in y&&"constructor"in x&&!(typeof Lr=="function"&&Lr instanceof Lr&&typeof Mr=="function"&&Mr instanceof Mr)&&(gt=!1)}return se.delete(y),se.delete(x),gt}function ns(y){return pa(y,Pa,Da)}function Rr(y,x){var R=y.__data__;return xa(x)?R[typeof x=="string"?"string":"hash"]:R.map}function er(y,x){var R=ge(y,x);return ba(R)?R:void 0}function va(y){var x=te.call(y,ut),R=y[ut];try{y[ut]=void 0;var G=!0}catch{}var Oe=we.call(y);return G&&(x?y[ut]=R:delete y[ut]),Oe}var Da=zt?function(y){return y==null?[]:(y=Object(y),be(zt(y),function(x){return Et.call(y,x)}))}:Fa,Ft=hr;(Le&&Ft(new Le(new ArrayBuffer(1)))!=J||Ce&&Ft(new Ce)!=P||Me&&Ft(Me.resolve())!=b||$e&&Ft(new $e)!=p||je&&Ft(new je)!=j)&&(Ft=function(y){var x=hr(y),R=x==l?y.constructor:void 0,G=R?Ht(R):"";if(G)switch(G){case He:return J;case qe:return P;case Ke:return b;case Ve:return p;case Ge:return j}return x});function Sa(y,x){return x=x??u,!!x&&(typeof y=="number"||Z.test(y))&&y>-1&&y%1==0&&y<x}function xa(y){var x=typeof y;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?y!=="__proto__":y===null}function Ia(y){return!!_e&&_e in y}function Oa(y){var x=y&&y.constructor,R=typeof x=="function"&&x.prototype||ee;return y===R}function Ta(y){return we.call(y)}function Ht(y){if(y!=null){try{return pe.call(y)}catch{}try{return y+""}catch{}}return""}function os(y,x){return y===x||y!==y&&x!==x}var Aa=rs(function(){return arguments}())?rs:function(y){return ur(y)&&te.call(y,"callee")&&!Et.call(y,"callee")},Ur=Array.isArray;function Na(y){return y!=null&&cs(y.length)&&!as(y)}var si=cr||Ra;function Ca(y,x){return is(y,x)}function as(y){if(!hs(y))return!1;var x=hr(y);return x==v||x==D||x==w||x==f}function cs(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=u}function hs(y){var x=typeof y;return y!=null&&(x=="object"||x=="function")}function ur(y){return y!=null&&typeof y=="object"}var us=le?Ne(le):_a;function Pa(y){return Na(y)?ga(y):wa(y)}function Fa(){return[]}function Ra(){return!1}t.exports=Ca})(af,Gr);function cf(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var c=t.charAt(s),u=c.charCodeAt(0);if(r[u]!==255)throw new TypeError(c+" is ambiguous");r[u]=s}var a=t.length,h=t.charAt(0),w=Math.log(a)/Math.log(256),_=Math.log(256)/Math.log(a);function E(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var P=0,T=0,L=0,l=D.length;L!==l&&D[L]===0;)L++,P++;for(var b=(l-L)*_+1>>>0,f=new Uint8Array(b);L!==l;){for(var g=D[L],p=0,n=b-1;(g!==0||p<T)&&n!==-1;n--,p++)g+=256*f[n]>>>0,f[n]=g%a>>>0,g=g/a>>>0;if(g!==0)throw new Error("Non-zero carry");T=p,L++}for(var d=b-T;d!==b&&f[d]===0;)d++;for(var F=h.repeat(P);d<b;++d)F+=t.charAt(f[d]);return F}function C(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var P=0;if(D[P]!==" "){for(var T=0,L=0;D[P]===h;)T++,P++;for(var l=(D.length-P)*w+1>>>0,b=new Uint8Array(l);D[P];){var f=r[D.charCodeAt(P)];if(f===255)return;for(var g=0,p=l-1;(f!==0||g<L)&&p!==-1;p--,g++)f+=a*b[p]>>>0,b[p]=f%256>>>0,f=f/256>>>0;if(f!==0)throw new Error("Non-zero carry");L=g,P++}if(D[P]!==" "){for(var n=l-L;n!==l&&b[n]===0;)n++;for(var d=new Uint8Array(T+(l-n)),F=T;n!==l;)d[F++]=b[n++];return d}}}function v(D){var P=C(D);if(P)return P;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:C,decode:v}}var hf=cf,uf=hf;const Po=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},lf=t=>new TextEncoder().encode(t),ff=t=>new TextDecoder().decode(t);class df{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class gf{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Fo(this,e)}}class pf{constructor(e){this.decoders=e}or(e){return Fo(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Fo=(t,e)=>new pf({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class yf{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new df(e,r,i),this.decoder=new gf(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ri=({name:t,prefix:e,encode:r,decode:i})=>new yf(t,e,r,i),Nr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=uf(r,e);return ri({prefix:t,name:e,encode:i,decode:c=>Po(s(c))})},bf=(t,e,r,i)=>{const s={};for(let _=0;_<e.length;++_)s[e[_]]=_;let c=t.length;for(;t[c-1]==="=";)--c;const u=new Uint8Array(c*r/8|0);let a=0,h=0,w=0;for(let _=0;_<c;++_){const E=s[t[_]];if(E===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|E,a+=r,a>=8&&(a-=8,u[w++]=255&h>>a)}if(a>=r||255&h<<8-a)throw new SyntaxError("Unexpected end of data");return u},_f=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let c="",u=0,a=0;for(let h=0;h<t.length;++h)for(a=a<<8|t[h],u+=8;u>r;)u-=r,c+=e[s&a>>u];if(u&&(c+=e[s&a<<r-u]),i)for(;c.length*r&7;)c+="=";return c},et=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ri({prefix:e,name:t,encode(s){return _f(s,i,r)},decode(s){return bf(s,i,r,t)}}),wf=ri({prefix:"\0",name:"identity",encode:t=>ff(t),decode:t=>lf(t)});var mf=Object.freeze({__proto__:null,identity:wf});const Ef=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var vf=Object.freeze({__proto__:null,base2:Ef});const Df=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Sf=Object.freeze({__proto__:null,base8:Df});const xf=Nr({prefix:"9",name:"base10",alphabet:"0123456789"});var If=Object.freeze({__proto__:null,base10:xf});const Of=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Tf=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Af=Object.freeze({__proto__:null,base16:Of,base16upper:Tf});const Nf=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Cf=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Pf=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ff=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Rf=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Uf=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Lf=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Mf=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),$f=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var jf=Object.freeze({__proto__:null,base32:Nf,base32upper:Cf,base32pad:Pf,base32padupper:Ff,base32hex:Rf,base32hexupper:Uf,base32hexpad:Lf,base32hexpadupper:Mf,base32z:$f});const zf=Nr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Bf=Nr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Hf=Object.freeze({__proto__:null,base36:zf,base36upper:Bf});const qf=Nr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Kf=Nr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Vf=Object.freeze({__proto__:null,base58btc:qf,base58flickr:Kf});const Gf=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),kf=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Wf=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yf=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Jf=Object.freeze({__proto__:null,base64:Gf,base64pad:kf,base64url:Wf,base64urlpad:Yf});const Ro=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Xf=Ro.reduce((t,e,r)=>(t[r]=e,t),[]),Zf=Ro.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Qf(t){return t.reduce((e,r)=>(e+=Xf[r],e),"")}function ed(t){const e=[];for(const r of t){const i=Zf[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const td=ri({prefix:"🚀",name:"base256emoji",encode:Qf,decode:ed});var rd=Object.freeze({__proto__:null,base256emoji:td}),id=Uo,cn=128,sd=127,nd=~sd,od=Math.pow(2,31);function Uo(t,e,r){e=e||[],r=r||0;for(var i=r;t>=od;)e[r++]=t&255|cn,t/=128;for(;t&nd;)e[r++]=t&255|cn,t>>>=7;return e[r]=t|0,Uo.bytes=r-i+1,e}var ad=Pi,cd=128,hn=127;function Pi(t,i){var r=0,i=i||0,s=0,c=i,u,a=t.length;do{if(c>=a)throw Pi.bytes=0,new RangeError("Could not decode varint");u=t[c++],r+=s<28?(u&hn)<<s:(u&hn)*Math.pow(2,s),s+=7}while(u>=cd);return Pi.bytes=c-i,r}var hd=Math.pow(2,7),ud=Math.pow(2,14),ld=Math.pow(2,21),fd=Math.pow(2,28),dd=Math.pow(2,35),gd=Math.pow(2,42),pd=Math.pow(2,49),yd=Math.pow(2,56),bd=Math.pow(2,63),_d=function(t){return t<hd?1:t<ud?2:t<ld?3:t<fd?4:t<dd?5:t<gd?6:t<pd?7:t<yd?8:t<bd?9:10},wd={encode:id,decode:ad,encodingLength:_d},Lo=wd;const un=(t,e,r=0)=>(Lo.encode(t,e,r),e),ln=t=>Lo.encodingLength(t),Fi=(t,e)=>{const r=e.byteLength,i=ln(t),s=i+ln(r),c=new Uint8Array(s+r);return un(t,c,0),un(r,c,i),c.set(e,s),new md(t,r,e,c)};class md{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const Mo=({name:t,code:e,encode:r})=>new Ed(t,e,r);class Ed{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Fi(this.code,r):r.then(i=>Fi(this.code,i))}else throw Error("Unknown type, must be binary type")}}const $o=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),vd=Mo({name:"sha2-256",code:18,encode:$o("SHA-256")}),Dd=Mo({name:"sha2-512",code:19,encode:$o("SHA-512")});var Sd=Object.freeze({__proto__:null,sha256:vd,sha512:Dd});const jo=0,xd="identity",zo=Po,Id=t=>Fi(jo,zo(t)),Od={code:jo,name:xd,encode:zo,digest:Id};var Td=Object.freeze({__proto__:null,identity:Od});new TextEncoder,new TextDecoder;const fn={...mf,...vf,...Sf,...If,...Af,...jf,...Hf,...Vf,...Jf,...rd};({...Sd,...Td});function Ad(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Bo(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const dn=Bo("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),yi=Bo("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Ad(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Nd={utf8:dn,"utf-8":dn,hex:fn.base16,latin1:yi,ascii:yi,binary:yi,...fn};function Cd(t,e="utf8"){const r=Nd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}const Ho="wc",Pd=2,Xi="core",$t=`${Ho}@${2}:${Xi}:`,Fd={name:Xi,logger:"error"},Rd={database:":memory:"},Ud="crypto",gn="client_ed25519_seed",Ld=Q.ONE_DAY,Md="keychain",$d="0.3",jd="messages",zd="0.3",Bd=Q.SIX_HOURS,Hd="publisher",qo="irn",qd="error",Kd="wss://relay.walletconnect.com",Vd="relayer",nt={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed"},Gd="_subscription",jr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},pn=Q.ONE_SECOND,kd="2.1.3",Wd="0.3",St={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Yd="subscription",Jd="0.3",Xd=Q.FIVE_SECONDS*1e3,Zd="pairing",Qd="0.3",br={wc_pairingDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:0},res:{ttl:Q.ONE_DAY,prompt:!1,tag:0}}},Dt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},eg="history",tg="0.3",rg="expirer",pt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},ig="0.3";class sg{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=Md,this.version=$d,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:c}=K("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(c)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Do(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?So(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ng{constructor(e,r,i){this.core=e,this.logger=r,this.name=Ud,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),c=js(s);return co(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=tl();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const c=await this.getClientSeed(),u=js(c),a=Ti();return await pu(a,s,Ld,u)},this.generateSharedKey=(s,c,u)=>{this.isInitialized();const a=this.getPrivateKey(s),h=rl(a,c);return this.setSymKey(h,u)},this.setSymKey=async(s,c)=>{this.isInitialized();const u=c||il(s);return await this.keychain.set(u,s),u},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,c,u)=>{this.isInitialized();const a=Eo(u),h=Ri(c);if(Ws(a)){const C=a.senderPublicKey,v=a.receiverPublicKey;s=await this.generateSharedKey(C,v)}const w=this.getSymKey(s),{type:_,senderPublicKey:E}=a;return nl({type:_,symKey:w,message:h,senderPublicKey:E})},this.decode=async(s,c,u)=>{this.isInitialized();const a=cl(c,u);if(Ws(a)){const _=a.receiverPublicKey,E=a.senderPublicKey;s=await this.generateSharedKey(_,E)}const h=this.getSymKey(s),w=ol({symKey:h,encoded:c});return $n(w)},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.keychain=i||new sg(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const r=Wi(e);return Tr(r.type)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(gn)}catch{e=Ti(),await this.keychain.set(gn,e)}return Cd(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class og extends Sc{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=jd,this.version=zd,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const c=Ai(s);let u=this.messages.get(i);return typeof u>"u"&&(u={}),typeof u[c]<"u"||(u[c]=s,this.messages.set(i,u),await this.persist()),c},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const c=this.get(i),u=Ai(s);return typeof c[u]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=r}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Do(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?So(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ag extends xc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new bt.EventEmitter,this.name=Hd,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,s,c)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}});try{const u=(c==null?void 0:c.ttl)||Bd,a=Ni(c),h=(c==null?void 0:c.prompt)||!1,w=(c==null?void 0:c.tag)||0,_={topic:i,message:s,opts:{ttl:u,relay:a,prompt:h,tag:w}},E=Ai(s);this.queue.set(E,_);try{await await xo(this.rpcPublish(i,s,u,a,h,w),this.publishTimeout)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(nt.connection_stalled);return}this.onPublish(E,_),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,r,i,s,c,u){var a,h,w,_;const E={method:Ci(s.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:c,tag:u}};return yt((a=E.params)==null?void 0:a.prompt)&&((h=E.params)==null||delete h.prompt),yt((w=E.params)==null?void 0:w.tag)&&((_=E.params)==null||delete _.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.provider.request(E)}onPublish(e,r){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:s}=e;await this.publish(r,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(xr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class cg{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(c=>c!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var hg=Object.defineProperty,ug=Object.defineProperties,lg=Object.getOwnPropertyDescriptors,yn=Object.getOwnPropertySymbols,fg=Object.prototype.hasOwnProperty,dg=Object.prototype.propertyIsEnumerable,bn=(t,e,r)=>e in t?hg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zr=(t,e)=>{for(var r in e||(e={}))fg.call(e,r)&&bn(t,r,e[r]);if(yn)for(var r of yn(e))dg.call(e,r)&&bn(t,r,e[r]);return t},bi=(t,e)=>ug(t,lg(e));class gg extends Tc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new cg,this.events=new bt.EventEmitter,this.name=Yd,this.version=Jd,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=$t,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const c=Ni(s),u={topic:i,relay:c};this.pending.set(i,u);const a=await this.rpcSubscribe(i,c);return this.onSubscribe(a,u),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),a}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,c)=>{const u=new Q.Watch;u.start(this.pendingSubscriptionWatchLabel);const a=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(a),u.stop(this.pendingSubscriptionWatchLabel),s(!0)),u.elapsed(this.pendingSubscriptionWatchLabel)>=Xd&&(clearInterval(a),u.stop(this.pendingSubscriptionWatchLabel),c(!1))},this.pendingSubInterval)}),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Ni(i);await this.rpcUnsubscribe(e,r,s);const c=Je("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r){const i={method:Ci(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await xo(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(nt.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:Ci(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,r){this.setSubscription(e,bi(zr({},r),{id:e})),this.pending.delete(r.topic)}onResubscribe(e,r){this.addSubscription(e,bi(zr({},r),{id:e})),this.pending.delete(r.topic)}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,zr({},r)),this.topicMap.set(r.topic,e),this.events.emit(St.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(St.deleted,bi(zr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(St.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(St.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:r,relay:i}=e,s={topic:r,relay:i};this.pending.set(s.topic,s);const c=await this.rpcSubscribe(s.topic,s.relay);this.onResubscribe(c,s)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const r=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(r,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(xr.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(nt.connect,async()=>{await this.onConnect()}),this.relayer.on(nt.disconnect,()=>{this.onDisconnect()}),this.events.on(St.created,async e=>{const r=St.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(St.deleted,async e=>{const r=St.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var pg=Object.defineProperty,_n=Object.getOwnPropertySymbols,yg=Object.prototype.hasOwnProperty,bg=Object.prototype.propertyIsEnumerable,wn=(t,e,r)=>e in t?pg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_g=(t,e)=>{for(var r in e||(e={}))yg.call(e,r)&&wn(t,r,e[r]);if(_n)for(var r of _n(e))bg.call(e,r)&&wn(t,r,e[r]);return t};class wg extends Ic{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new bt.EventEmitter,this.name=Vd,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):Dr(Se.getDefaultLoggerOptions({level:e.logger||qd})),this.messages=new og(this.logger,e.core),this.subscriber=new gg(this,this.logger),this.publisher=new ag(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Kd,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r})}async subscribe(e,r){this.isInitialized();let i="";return await Promise.all([new Promise(s=>{this.subscriber.once(St.created,c=>{c.topic===e&&s()})}),new Promise(async s=>{i=await this.subscriber.subscribe(e,r),s()})]),i}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&await this.provider.disconnect(),this.events.emit(nt.transport_closed)}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(St.resubscribed,()=>{r()})}),await Promise.race([this.provider.connect(),new Promise((r,i)=>this.once(nt.transport_closed,()=>{i()}))])])}catch(r){const i=r;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(nt.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(r=>setTimeout(r,pn)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new Li(new of(vl({sdkVersion:kd,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;return await this.subscriber.isSubscribed(r)?this.messages.has(r,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Mi(e)){if(!e.method.endsWith(Gd))return;const r=e.params,{topic:i,message:s}=r.data,c={topic:i,message:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(_g({type:"event",event:r.id},c)),this.events.emit(r.id,c),await this.acknowledgePayload(e),await this.onMessageEvent(c)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(nt.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=$i(e.id,!0);await this.provider.connection.send(r)}registerEventListeners(){this.provider.on(jr.payload,e=>this.onProviderPayload(e)),this.provider.on(jr.connect,()=>{this.events.emit(nt.connect)}),this.provider.on(jr.disconnect,()=>{this.events.emit(nt.disconnect),this.attemptToReconnect()}),this.provider.on(jr.error,e=>this.events.emit(nt.error,e)),this.events.on(nt.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},Q.toMiliseconds(pn))}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var mg=Object.defineProperty,mn=Object.getOwnPropertySymbols,Eg=Object.prototype.hasOwnProperty,vg=Object.prototype.propertyIsEnumerable,En=(t,e,r)=>e in t?mg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vn=(t,e)=>{for(var r in e||(e={}))Eg.call(e,r)&&En(t,r,e[r]);if(mn)for(var r of mn(e))vg.call(e,r)&&En(t,r,e[r]);return t};class ii extends Oc{constructor(e,r,i,s=$t,c=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=Wd,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(u=>{Hl(u)?this.map.set(u.id,u):ql(u)?this.map.set(u.topic,u):this.getKey&&u!==null&&!yt(u)&&this.map.set(this.getKey(u),u)}),this.cached=[],this.initialized=!0)},this.set=async(u,a)=>{this.isInitialized(),this.map.has(u)?await this.update(u,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:u,value:a}),this.map.set(u,a),await this.persist())},this.get=u=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:u}),this.getData(u)),this.getAll=u=>(this.isInitialized(),u?this.values.filter(a=>Object.keys(u).every(h=>Gr(a[h],u[h]))):this.values),this.update=async(u,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:u,update:a});const h=vn(vn({},this.getData(u)),a);this.map.set(u,h),await this.persist()},this.delete=async(u,a)=>{this.isInitialized(),this.map.has(u)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:u,reason:a}),this.map.delete(u),await this.persist())},this.logger=Se.generateChildLogger(r,this.name),this.storagePrefix=s,this.getKey=c}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Dg{constructor(e,r){this.core=e,this.logger=r,this.name=Zd,this.version=Qd,this.events=new bt,this.initialized=!1,this.storagePrefix=$t,this.ignoredPayloadTypes=[Zt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Ti(),s=await this.core.crypto.setSymKey(i),c=Nt(Q.FIVE_MINUTES),u={protocol:qo},a={topic:s,expiry:c,relay:u,active:!1},h=Fl({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:u});return await this.pairings.set(s,a),await this.core.relayer.subscribe(s),this.core.expirer.set(s,c),{topic:s,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:c,relay:u}=Cl(i.uri),a=Nt(Q.FIVE_MINUTES),h={topic:s,relay:u,expiry:a,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(c,s),await this.core.relayer.subscribe(s,{relay:u}),this.core.expirer.set(s,a),i.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:i})=>{this.isInitialized();const s=Nt(Q.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const c=await this.sendRequest(s,"wc_pairingPing",{}),{done:u,resolve:a,reject:h}=Wt();this.events.once(Ue("pairing_ping",c),({error:w})=>{w?h(w):a()}),await u()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Je("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,c)=>{const u=ji(s,c),a=await this.core.crypto.encode(i,u),h=br[s].req;return this.core.history.set(i,u),await this.core.relayer.publish(i,a,h),u.id},this.sendResult=async(i,s,c)=>{const u=$i(i,c),a=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),w=br[h.request.method].res;await this.core.relayer.publish(s,a,w),await this.core.history.resolve(u)},this.sendError=async(i,s,c)=>{const u=Ui(i,c),a=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),w=br[h.request.method]?br[h.request.method].res:br.unregistered_method.res;await this.core.relayer.publish(s,a,w),await this.core.history.resolve(u)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Je("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>Mt(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:c}=i;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(s,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,c);default:return this.onUnknownRpcMethodRequest(s,c)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:c}=i,u=(await this.core.history.get(s,c.id)).request.method;switch(u){case"wc_pairingPing":return this.onPairingPingResponse(s,c);default:return this.onUnknownRpcMethodResponse(u)}},this.onPairingPingRequest=async(i,s)=>{const{id:c}=s;try{this.isValidPing({topic:i}),await this.sendResult(c,i,!0),this.events.emit("pairing_ping",{id:c,topic:i})}catch(u){await this.sendError(c,i,u),this.logger.error(u)}},this.onPairingPingResponse=(i,s)=>{const{id:c}=s;setTimeout(()=>{Lt(s)?this.events.emit(Ue("pairing_ping",c),{}):At(s)&&this.events.emit(Ue("pairing_ping",c),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:c}=s;try{this.isValidDisconnect({topic:i}),await this.sendResult(c,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:c,topic:i})}catch(u){await this.sendError(c,i,u),this.logger.error(u)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:c,method:u}=s;try{if(this.registeredMethods.includes(u))return;const a=Je("WC_METHOD_UNSUPPORTED",u);await this.sendError(c,i,a),this.logger.error(a)}catch(a){await this.sendError(c,i,a),this.logger.error(a)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Je("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!st(i)){const{message:s}=K("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!Bl(i.uri)){const{message:s}=K("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!st(i)){const{message:c}=K("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!st(i)){const{message:c}=K("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!Ze(i,!1)){const{message:s}=K("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=K("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Mt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=K("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.pairings=new ii(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(nt.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(r,i);Mi(s)?(this.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):jn(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:r,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(pt.expired,async e=>{const{topic:r}=Oo(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class Sg extends Dc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new bt.EventEmitter,this.name=eg,this.version=tg,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:c}),this.records.has(s.id))return;const u={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:c};this.records.set(u.id,u),this.events.emit(Dt.created,u)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=At(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(Dt.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(c=>{if(c.topic===i){if(typeof s<"u"&&c.id!==s)return;this.records.delete(c.id),this.events.emit(Dt.deleted,c)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:ji(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Dt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Dt.created,e=>{const r=Dt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Dt.updated,e=>{const r=Dt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Dt.deleted,e=>{const r=Dt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class xg extends Ac{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new bt.EventEmitter,this.name=rg,this.version=ig,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const c=this.formatTarget(i),u={target:c,expiry:s};this.expirations.set(c,u),this.checkExpiry(c,u),this.events.emit(pt.created,{target:c,expiration:u})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{this.isInitialized();const s=this.formatTarget(i);if(this.has(s)){const c=this.getExpiration(s);this.expirations.delete(s),this.events.emit(pt.deleted,{target:s,expiration:c})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Dl(e);if(typeof e=="number")return Sl(e);const{message:r}=K("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(pt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Q.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(pt.expired,{target:e,expiration:r})}checkExpirations(){this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(xr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(pt.created,e=>{const r=pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(pt.expired,e=>{const r=pt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(pt.deleted,e=>{const r=pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Ig=Object.defineProperty,Dn=Object.getOwnPropertySymbols,Og=Object.prototype.hasOwnProperty,Tg=Object.prototype.propertyIsEnumerable,Sn=(t,e,r)=>e in t?Ig(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xn=(t,e)=>{for(var r in e||(e={}))Og.call(e,r)&&Sn(t,r,e[r]);if(Dn)for(var r of Dn(e))Tg.call(e,r)&&Sn(t,r,e[r]);return t};class Zi extends vc{constructor(e){super(e),this.protocol=Ho,this.version=Pd,this.name=Xi,this.events=new bt.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Dr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Fd.logger}));this.logger=Se.generateChildLogger(r,this.name),this.heartbeat=new xr.HeartBeat,this.crypto=new ng(this,this.logger,e==null?void 0:e.keychain),this.history=new Sg(this,this.logger),this.expirer=new xg(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new ac(xn(xn({},Rd),e==null?void 0:e.storageOptions)),this.relayer=new wg({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new Dg(this,this.logger)}static async init(e){const r=new Zi(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initilization Success")}catch(e){throw this.logger.warn(`Core Initilization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Ag=Zi,Ko="wc",Vo=2,Go="client",Qi=`${Ko}@${Vo}:${Go}:`,_i={name:Go,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Ng="proposal",Cg="session",Br=Q.SEVEN_DAYS,Pg="engine",_r={wc_sessionPropose:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1115}}},Fg="request";var Rg=Object.defineProperty,Ug=Object.defineProperties,Lg=Object.getOwnPropertyDescriptors,In=Object.getOwnPropertySymbols,Mg=Object.prototype.hasOwnProperty,$g=Object.prototype.propertyIsEnumerable,On=(t,e,r)=>e in t?Rg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ut=(t,e)=>{for(var r in e||(e={}))Mg.call(e,r)&&On(t,r,e[r]);if(In)for(var r of In(e))$g.call(e,r)&&On(t,r,e[r]);return t},Tn=(t,e)=>Ug(t,Lg(e));class jg extends Cc{constructor(e){super(e),this.name=Pg,this.events=new bt,this.initialized=!1,this.ignoredPayloadTypes=[Zt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(_r)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized(),await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:s,relays:c}=r;let u=i,a,h=!1;if(u&&(h=this.client.core.pairing.pairings.get(u).active),!u||!h){const{topic:T,uri:L}=await this.client.core.pairing.create();u=T,a=L}const w=await this.client.core.crypto.generateKeyPair(),_={requiredNamespaces:s,relays:c??[{protocol:qo}],proposer:{publicKey:w,metadata:this.client.metadata}},{reject:E,resolve:C,done:v}=Wt();if(this.events.once(Ue("session_connect"),async({error:T,session:L})=>{if(T)E(T);else if(L){L.self.publicKey=w;const l=Tn(Ut({},L),{requiredNamespaces:s});await this.client.session.set(L.topic,l),await this.setExpiry(L.topic,L.expiry),u&&await this.client.core.pairing.updateMetadata({topic:u,metadata:L.peer.metadata}),C(l)}}),!u){const{message:T}=K("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(T)}const D=await this.sendRequest(u,"wc_sessionPropose",_),P=Nt(Q.FIVE_MINUTES);return await this.setProposal(D,Ut({id:D,expiry:P},_)),{uri:a,approval:v}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:s,namespaces:c}=r,{pairingTopic:u,proposer:a,requiredNamespaces:h}=this.client.proposal.get(i),w=await this.client.core.crypto.generateKeyPair(),_=a.publicKey,E=await this.client.core.crypto.generateSharedKey(w,_),C={relay:{protocol:s??"irn"},namespaces:c,requiredNamespaces:h,controller:{publicKey:w,metadata:this.client.metadata},expiry:Nt(Br)};await this.client.core.relayer.subscribe(E);const v=await this.sendRequest(E,"wc_sessionSettle",C),{done:D,resolve:P,reject:T}=Wt();this.events.once(Ue("session_approve",v),({error:l})=>{l?T(l):P(this.client.session.get(E))});const L=Tn(Ut({},C),{topic:E,acknowledged:!1,self:C.controller,peer:{publicKey:a.publicKey,metadata:a.metadata},controller:w});return await this.client.session.set(E,L),await this.setExpiry(E,Nt(Br)),u&&await this.client.core.pairing.updateMetadata({topic:u,metadata:L.peer.metadata}),u&&i&&(await this.sendResult(i,u,{relay:{protocol:s??"irn"},responderPublicKey:w}),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:u})),{topic:E,acknowledged:D}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:s}=r,{pairingTopic:c}=this.client.proposal.get(i);c&&(await this.sendError(i,c,s),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:s}=r,c=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:s}),{done:u,resolve:a,reject:h}=Wt();return this.events.once(Ue("session_update",c),({error:w})=>{w?h(w):a()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:u}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,s=await this.sendRequest(i,"wc_sessionExtend",{}),{done:c,resolve:u,reject:a}=Wt();return this.events.once(Ue("session_extend",s),({error:h})=>{h?a(h):u()}),await this.setExpiry(i,Nt(Br)),{acknowledged:c}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:s,topic:c}=r,u=await this.sendRequest(c,"wc_sessionRequest",{request:s,chainId:i}),{done:a,resolve:h,reject:w}=Wt();return this.events.once(Ue("session_request",u),({error:_,result:E})=>{_?w(_):h(E)}),await a()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:c}=s;Lt(s)?await this.sendResult(c,i,s.result):At(s)&&await this.sendError(c,i,s.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=await this.sendRequest(i,"wc_sessionPing",{}),{done:c,resolve:u,reject:a}=Wt();this.events.once(Ue("session_ping",s),({error:h})=>{h?a(h):u()}),await c()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:s,chainId:c}=r;await this.sendRequest(i,"wc_sessionEvent",{event:s,chainId:c})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",Je("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>jl(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(r,i)=>{const{self:s}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await Promise.all([this.client.session.delete(r,Je("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(r),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,Je("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=_r.wc_sessionRequest.req.ttl,{id:s,topic:c,params:u}=r;await this.client.pendingRequest.set(s,{id:s,topic:c,params:u}),i&&this.client.core.expirer.set(s,i)},this.sendRequest=async(r,i,s)=>{const c=ji(i,s),u=await this.client.core.crypto.encode(r,c),a=_r[i].req;return this.client.core.history.set(r,c),this.client.core.relayer.publish(r,u,a),c.id},this.sendResult=async(r,i,s)=>{const c=$i(r,s),u=await this.client.core.crypto.encode(i,c),a=await this.client.core.history.get(i,r),h=_r[a.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(c)},this.sendError=async(r,i,s)=>{const c=Ui(r,s),u=await this.client.core.crypto.encode(i,c),a=await this.client.core.history.get(i,r),h=_r[a.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{Mt(s.expiry)&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Mt(s.expiry)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=r=>{const{topic:i,payload:s}=r,c=s.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:s}=r,c=(await this.client.core.history.get(i,s.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onSessionProposeRequest=async(r,i)=>{const{params:s,id:c}=i;try{this.isValidConnect(Ut({},i.params));const u=Nt(Q.FIVE_MINUTES),a=Ut({id:c,pairingTopic:r,expiry:u},s);await this.setProposal(c,a),this.client.events.emit("session_proposal",{id:c,params:a})}catch(u){await this.sendError(c,r,u),this.client.logger.error(u)}},this.onSessionProposeResponse=async(r,i)=>{const{id:s}=i;if(Lt(i)){const{result:c}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const u=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:u});const a=u.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});const h=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const w=await this.client.core.crypto.generateSharedKey(a,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:w});const _=await this.client.core.relayer.subscribe(w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:_}),await this.client.core.pairing.activate({topic:r})}else At(i)&&(await this.client.proposal.delete(s,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:s,params:c}=i;try{this.isValidSessionSettleRequest(c);const{relay:u,controller:a,expiry:h,namespaces:w}=i.params,_={topic:r,relay:u,expiry:h,namespaces:w,acknowledged:!0,controller:a.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}};await this.sendResult(i.id,r,!0),this.events.emit(Ue("session_connect"),{session:_})}catch(u){await this.sendError(s,r,u),this.client.logger.error(u)}},this.onSessionSettleResponse=async(r,i)=>{const{id:s}=i;Lt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ue("session_approve",s),{})):At(i)&&(await this.client.session.delete(r,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:s,id:c}=i;try{this.isValidUpdate(Ut({topic:r},s)),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult(c,r,!0),this.client.events.emit("session_update",{id:c,topic:r,params:s})}catch(u){await this.sendError(c,r,u),this.client.logger.error(u)}},this.onSessionUpdateResponse=(r,i)=>{const{id:s}=i;Lt(i)?this.events.emit(Ue("session_update",s),{}):At(i)&&this.events.emit(Ue("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Nt(Br)),await this.sendResult(s,r,!0),this.client.events.emit("session_extend",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,i)=>{const{id:s}=i;Lt(i)?this.events.emit(Ue("session_extend",s),{}):At(i)&&this.events.emit(Ue("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.client.events.emit("session_ping",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,i)=>{const{id:s}=i;setTimeout(()=>{Lt(i)?this.events.emit(Ue("session_ping",s),{}):At(i)&&this.events.emit(Ue("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await this.sendResult(s,r,!0),await this.deleteSession(r),this.client.events.emit("session_delete",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionRequest=async(r,i)=>{const{id:s,params:c}=i;try{this.isValidRequest(Ut({topic:r},c)),await this.setPendingSessionRequest({id:s,topic:r,params:c}),this.client.events.emit("session_request",{id:s,topic:r,params:c})}catch(u){await this.sendError(s,r,u),this.client.logger.error(u)}},this.onSessionRequestResponse=(r,i)=>{const{id:s}=i;Lt(i)?this.events.emit(Ue("session_request",s),{result:i.result}):At(i)&&this.events.emit(Ue("session_request",s),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:s,params:c}=i;try{this.isValidEmit(Ut({topic:r},c)),this.client.events.emit("session_event",{id:s,topic:r,params:c})}catch(u){await this.sendError(s,r,u),this.client.logger.error(u)}},this.isValidConnect=async r=>{if(!st(r)){const{message:a}=K("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(a)}const{pairingTopic:i,requiredNamespaces:s,relays:c}=r;yt(i)||await this.isValidPairingTopic(i);const u=kl(s,"connect()");if(u)throw new Error(u.message);if(!Wl(c,!0)){const{message:a}=K("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(a)}},this.isValidApprove=async r=>{if(!st(r))throw new Error(K("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:c}=r;await this.isValidProposalId(i);const u=this.client.proposal.get(i),a=pi(s,"approve()");if(a)throw new Error(a.message);const h=on(u.requiredNamespaces,s,"update()");if(h)throw new Error(h.message);if(!Ze(c,!0)){const{message:w}=K("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(w)}},this.isValidReject=async r=>{if(!st(r)){const{message:c}=K("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:i,reason:s}=r;if(await this.isValidProposalId(i),!Jl(s)){const{message:c}=K("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!st(r)){const{message:w}=K("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(w)}const{relay:i,controller:s,namespaces:c,expiry:u}=r;if(!Co(i)){const{message:w}=K("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(w)}const a=Kl(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const h=pi(c,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Mt(u)){const{message:w}=K("EXPIRED","onSessionSettleRequest()");throw new Error(w)}},this.isValidUpdate=async r=>{if(!st(r)){const{message:h}=K("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(h)}const{topic:i,namespaces:s}=r;await this.isValidSessionTopic(i);const c=this.client.session.get(i),u=pi(s,"update()");if(u)throw new Error(u.message);const a=on(c.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)},this.isValidExtend=async r=>{if(!st(r)){const{message:s}=K("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!st(r)){const{message:a}=K("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(a)}const{topic:i,request:s,chainId:c}=r;await this.isValidSessionTopic(i);const{namespaces:u}=this.client.session.get(i);if(!nn(u,c)){const{message:a}=K("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(a)}if(!Xl(s)){const{message:a}=K("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(a)}if(!ef(u,c,s.method)){const{message:a}=K("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(a)}},this.isValidRespond=async r=>{if(!st(r)){const{message:c}=K("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(c)}const{topic:i,response:s}=r;if(await this.isValidSessionTopic(i),!Zl(s)){const{message:c}=K("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidPing=async r=>{if(!st(r)){const{message:s}=K("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!st(r)){const{message:a}=K("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:s,chainId:c}=r;await this.isValidSessionTopic(i);const{namespaces:u}=this.client.session.get(i);if(!nn(u,c)){const{message:a}=K("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(a)}if(!Ql(s)){const{message:a}=K("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!tf(u,c,s.name)){const{message:a}=K("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}},this.isValidDisconnect=async r=>{if(!st(r)){const{message:s}=K("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(nt.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(r,i);Mi(s)?(this.client.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):jn(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:r,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(pt.expired,async e=>{const{topic:r,id:i}=Oo(e.target);if(i&&this.getPendingSessionRequests()[i])return await this.deletePendingSessionRequest(i,K("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&await this.deleteProposal(i,!0)})}isValidPairingTopic(e){if(!Ze(e,!1)){const{message:r}=K("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=K("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Mt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=K("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Ze(e,!1)){const{message:r}=K("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=K("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Mt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=K("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ze(e,!1)){const{message:r}=K("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=K("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Yl(e)){const{message:r}=K("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=K("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Mt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=K("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class zg extends ii{constructor(e,r){super(e,r,Ng,Qi),this.core=e,this.logger=r}}class Bg extends ii{constructor(e,r){super(e,r,Cg,Qi),this.core=e,this.logger=r}}class Hg extends ii{constructor(e,r){super(e,r,Fg,Qi),this.core=e,this.logger=r}}let ko=class extends Nc{constructor(e){super(e),this.protocol=Ko,this.version=Vo,this.name=_i.name,this.events=new bt.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||_i.name,this.metadata=(e==null?void 0:e.metadata)||_l();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Dr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||_i.logger}));this.core=(e==null?void 0:e.core)||new Ag(e),this.logger=Se.generateChildLogger(r,this.name),this.session=new Bg(this.core,this.logger),this.proposal=new zg(this.core,this.logger),this.pendingRequest=new Hg(this.core,this.logger),this.engine=new jg(this)}static async init(e){const r=new ko(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initilization Success")}catch(e){throw this.logger.info("SignClient Initilization Failure"),this.logger.error(e.message),e}}};var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.getLocalStorage=Ie.getLocalStorageOrThrow=Ie.getCrypto=Ie.getCryptoOrThrow=Ie.getLocation=Ie.getLocationOrThrow=Ie.getNavigator=Ie.getNavigatorOrThrow=Ie.getDocument=Ie.getDocumentOrThrow=Ie.getFromWindowOrThrow=Ie.getFromWindow=void 0;function Qt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Ie.getFromWindow=Qt;function ar(t){const e=Qt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Ie.getFromWindowOrThrow=ar;function qg(){return ar("document")}Ie.getDocumentOrThrow=qg;function Kg(){return Qt("document")}Ie.getDocument=Kg;function Vg(){return ar("navigator")}Ie.getNavigatorOrThrow=Vg;function Gg(){return Qt("navigator")}Ie.getNavigator=Gg;function kg(){return ar("location")}Ie.getLocationOrThrow=kg;function Wg(){return Qt("location")}Ie.getLocation=Wg;function Yg(){return ar("crypto")}Ie.getCryptoOrThrow=Yg;function Jg(){return Qt("crypto")}Ie.getCrypto=Jg;function Xg(){return ar("localStorage")}Ie.getLocalStorageOrThrow=Xg;function Zg(){return Qt("localStorage")}Ie.getLocalStorage=Zg;var es={};Object.defineProperty(es,"__esModule",{value:!0});es.getWindowMetadata=void 0;const An=Ie;function Qg(){let t,e;try{t=An.getDocumentOrThrow(),e=An.getLocationOrThrow()}catch{return null}function r(){const E=t.getElementsByTagName("link"),C=[];for(let v=0;v<E.length;v++){const D=E[v],P=D.getAttribute("rel");if(P&&P.toLowerCase().indexOf("icon")>-1){const T=D.getAttribute("href");if(T)if(T.toLowerCase().indexOf("https:")===-1&&T.toLowerCase().indexOf("http:")===-1&&T.indexOf("//")!==0){let L=e.protocol+"//"+e.host;if(T.indexOf("/")===0)L+=T;else{const l=e.pathname.split("/");l.pop();const b=l.join("/");L+=b+"/"+T}C.push(L)}else if(T.indexOf("//")===0){const L=e.protocol+T;C.push(L)}else C.push(T)}}return C}function i(...E){const C=t.getElementsByTagName("meta");for(let v=0;v<C.length;v++){const D=C[v],P=["itemprop","property","name"].map(T=>D.getAttribute(T)).filter(T=>T?E.includes(T):!1);if(P.length&&P){const T=D.getAttribute("content");if(T)return T}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=t.title),E}function c(){return i("description","og:description","twitter:description","keywords")}const u=s(),a=c(),h=e.origin,w=r();return{description:a,url:h,icons:w,name:u}}es.getWindowMetadata=Qg;var ep={};(function(t){const e=Ln,r=Mn,i=Un,s=_o,c=l=>l==null,u=Symbol("encodeFragmentIdentifier");function a(l){switch(l.arrayFormat){case"index":return b=>(f,g)=>{const p=f.length;return g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[_(b,l),"[",p,"]"].join("")]:[...f,[_(b,l),"[",_(p,l),"]=",_(g,l)].join("")]};case"bracket":return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[_(b,l),"[]"].join("")]:[...f,[_(b,l),"[]=",_(g,l)].join("")];case"colon-list-separator":return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[_(b,l),":list="].join("")]:[...f,[_(b,l),":list=",_(g,l)].join("")];case"comma":case"separator":case"bracket-separator":{const b=l.arrayFormat==="bracket-separator"?"[]=":"=";return f=>(g,p)=>p===void 0||l.skipNull&&p===null||l.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[_(f,l),b,_(p,l)].join("")]:[[g,_(p,l)].join(l.arrayFormatSeparator)])}default:return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,_(b,l)]:[...f,[_(b,l),"=",_(g,l)].join("")]}}function h(l){let b;switch(l.arrayFormat){case"index":return(f,g,p)=>{if(b=/\[(\d*)\]$/.exec(f),f=f.replace(/\[\d*\]$/,""),!b){p[f]=g;return}p[f]===void 0&&(p[f]={}),p[f][b[1]]=g};case"bracket":return(f,g,p)=>{if(b=/(\[\])$/.exec(f),f=f.replace(/\[\]$/,""),!b){p[f]=g;return}if(p[f]===void 0){p[f]=[g];return}p[f]=[].concat(p[f],g)};case"colon-list-separator":return(f,g,p)=>{if(b=/(:list)$/.exec(f),f=f.replace(/:list$/,""),!b){p[f]=g;return}if(p[f]===void 0){p[f]=[g];return}p[f]=[].concat(p[f],g)};case"comma":case"separator":return(f,g,p)=>{const n=typeof g=="string"&&g.includes(l.arrayFormatSeparator),d=typeof g=="string"&&!n&&E(g,l).includes(l.arrayFormatSeparator);g=d?E(g,l):g;const F=n||d?g.split(l.arrayFormatSeparator).map(j=>E(j,l)):g===null?g:E(g,l);p[f]=F};case"bracket-separator":return(f,g,p)=>{const n=/(\[\])$/.test(f);if(f=f.replace(/\[\]$/,""),!n){p[f]=g&&E(g,l);return}const d=g===null?[]:g.split(l.arrayFormatSeparator).map(F=>E(F,l));if(p[f]===void 0){p[f]=d;return}p[f]=[].concat(p[f],d)};default:return(f,g,p)=>{if(p[f]===void 0){p[f]=g;return}p[f]=[].concat(p[f],g)}}}function w(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function _(l,b){return b.encode?b.strict?e(l):encodeURIComponent(l):l}function E(l,b){return b.decode?r(l):l}function C(l){return Array.isArray(l)?l.sort():typeof l=="object"?C(Object.keys(l)).sort((b,f)=>Number(b)-Number(f)).map(b=>l[b]):l}function v(l){const b=l.indexOf("#");return b!==-1&&(l=l.slice(0,b)),l}function D(l){let b="";const f=l.indexOf("#");return f!==-1&&(b=l.slice(f)),b}function P(l){l=v(l);const b=l.indexOf("?");return b===-1?"":l.slice(b+1)}function T(l,b){return b.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):b.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function L(l,b){b=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},b),w(b.arrayFormatSeparator);const f=h(b),g=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return g;for(const p of l.split("&")){if(p==="")continue;let[n,d]=i(b.decode?p.replace(/\+/g," "):p,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(b.arrayFormat)?d:E(d,b),f(E(n,b),d,g)}for(const p of Object.keys(g)){const n=g[p];if(typeof n=="object"&&n!==null)for(const d of Object.keys(n))n[d]=T(n[d],b);else g[p]=T(n,b)}return b.sort===!1?g:(b.sort===!0?Object.keys(g).sort():Object.keys(g).sort(b.sort)).reduce((p,n)=>{const d=g[n];return Boolean(d)&&typeof d=="object"&&!Array.isArray(d)?p[n]=C(d):p[n]=d,p},Object.create(null))}t.extract=P,t.parse=L,t.stringify=(l,b)=>{if(!l)return"";b=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},b),w(b.arrayFormatSeparator);const f=d=>b.skipNull&&c(l[d])||b.skipEmptyString&&l[d]==="",g=a(b),p={};for(const d of Object.keys(l))f(d)||(p[d]=l[d]);const n=Object.keys(p);return b.sort!==!1&&n.sort(b.sort),n.map(d=>{const F=l[d];return F===void 0?"":F===null?_(d,b):Array.isArray(F)?F.length===0&&b.arrayFormat==="bracket-separator"?_(d,b)+"[]":F.reduce(g(d),[]).join("&"):_(d,b)+"="+_(F,b)}).filter(d=>d.length>0).join("&")},t.parseUrl=(l,b)=>{b=Object.assign({decode:!0},b);const[f,g]=i(l,"#");return Object.assign({url:f.split("?")[0]||"",query:L(P(l),b)},b&&b.parseFragmentIdentifier&&g?{fragmentIdentifier:E(g,b)}:{})},t.stringifyUrl=(l,b)=>{b=Object.assign({encode:!0,strict:!0,[u]:!0},b);const f=v(l.url).split("?")[0]||"",g=t.extract(l.url),p=t.parse(g,{sort:!1}),n=Object.assign(p,l.query);let d=t.stringify(n,b);d&&(d=`?${d}`);let F=D(l.url);return l.fragmentIdentifier&&(F=`#${b[u]?_(l.fragmentIdentifier,b):l.fragmentIdentifier}`),`${f}${d}${F}`},t.pick=(l,b,f)=>{f=Object.assign({parseFragmentIdentifier:!0,[u]:!1},f);const{url:g,query:p,fragmentIdentifier:n}=t.parseUrl(l,f);return t.stringifyUrl({url:g,query:s(p,b),fragmentIdentifier:n},f)},t.exclude=(l,b,f)=>{const g=Array.isArray(b)?p=>!b.includes(p):(p,n)=>!b(p,n);return t.pick(l,g,f)}})(ep);const tp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function rp(t,e){const{message:r,code:i}=tp[t];return{message:e?`${r} ${e}`:r,code:i}}function ip(t){var e;const r=(e=t[Object.keys(t)[0]])==null?void 0:e.chains[0];return[r.split(":")[0],r.split(":")[1]]}function kr(t,e){let r;return e.rpcMap&&(r=e.rpcMap[sp([t])]),r}function sp(t){return Number(t[0].split(":")[1])}class np{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var r;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=r||kr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}createHttpProvider(e,r){const i=r||kr(e,this.namespace);return typeof i>"u"?void 0:new Li(new zn(i))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}}class op{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||kr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||kr(e,this.namespace);return typeof i>"u"?void 0:new Li(new zn(i))}}const Nn="error",ap="wss://relay.walletconnect.com",cp="wc",hp="universal_provider",Cn=`${cp}@${2}:${hp}:`;var up=Object.defineProperty,lp=Object.defineProperties,fp=Object.getOwnPropertyDescriptors,Pn=Object.getOwnPropertySymbols,dp=Object.prototype.hasOwnProperty,gp=Object.prototype.propertyIsEnumerable,Fn=(t,e,r)=>e in t?up(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rn=(t,e)=>{for(var r in e||(e={}))dp.call(e,r)&&Fn(t,r,e[r]);if(Pn)for(var r of Pn(e))gp.call(e,r)&&Fn(t,r,e[r]);return t},pp=(t,e)=>lp(t,fp(e));class ts{constructor(e){this.events=new bt,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Dr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Nn}))}static async init(e){const r=new ts(e);return await r.initialize(),r}async request(e,r){var i;const[s,c]=this.validateChain(r);return await this.getProvider(s).request({request:Rn({},e),chainId:`${s}:${c}`,topic:(i=this.session)==null?void 0:i.topic})}sendAsync(e,r,i){this.request(e,i).then(s=>r(null,s)).catch(s=>r(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return await this.request({method:"eth_requestAccounts",params:[]})}async disconnect(){if(!this.client)throw new Error("Sign Client not initialized");await this.client.disconnect({topic:this.session.topic,reason:rp("USER_DISCONNECTED")})}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");return this.setNamespaces(e.namespaces),this.createProviders(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return r&&(this.uri=r,this.events.emit("display_uri",r)),this.session=await i(),this.onSessionUpdate(),this.session}setDefaultChain(e,r){const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,r)}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${Cn}/namespaces`),this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ko.init({logger:this.providerOpts.logger||Nn,relayUrl:this.providerOpts.relayUrl||ap,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new np({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new op({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:s}=r,c=(i=this.client)==null?void 0:i.session.get(e);this.session=pp(Rn({},c),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",()=>{this.events.emit("session_delete")})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>this.getProvider(e).updateNamespace(this.session.namespaces[e]))}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${Cn}/namespaces`,e),this.namespaces=e}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(r&&!Object.keys(this.namespaces).includes(r))throw new Error(`Invalid namespace: ${r}`);return!r||!i?ip(this.namespaces):[r,i]}}const Op=ts;export{Op as UniversalProvider,ts as default};
